<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.33">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Ya-Nuo Hsu, Ziyue Han, and Ruiyan Tang">
<meta name="dcterms.date" content="2025-05-05">

<title>Credit Card Approval Prediction</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="final_project_files/libs/clipboard/clipboard.min.js"></script>
<script src="final_project_files/libs/quarto-html/quarto.js"></script>
<script src="final_project_files/libs/quarto-html/popper.min.js"></script>
<script src="final_project_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="final_project_files/libs/quarto-html/anchor.min.js"></script>
<link href="final_project_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="final_project_files/libs/quarto-html/quarto-syntax-highlighting-07ba0ad10f5680c660e360ac31d2f3b6.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="final_project_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="final_project_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="final_project_files/libs/bootstrap/bootstrap-d2ca21784b0c8e84cba19bb27f745769.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="final_project_files/libs/kePrint-0.0.1/kePrint.js"></script>
<link href="final_project_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Credit Card Approval Prediction</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Ya-Nuo Hsu, Ziyue Han, and Ruiyan Tang </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">May 5, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">1 Introduction</h2>
<p>Predicting credit card defaults is crucial for financial institutions aiming to effectively manage risk and maintain the health of their lending portfolios. According to Yeh and Lien (2009), defaults result not only in direct financial losses but also diminish lender confidence, ultimately increasing the bank’s cost of capital. In an era marked by rising consumer debt and economic instability, developing accurate early-warning systems to identify potential defaults is increasingly important. Such predictive systems can help banks proactively manage risk—by adjusting credit limits, offering financial counseling, or implementing targeted interventions—thus protecting both customers and institutional stability.</p>
<p>This study leverages the widely-used “Default of Credit Card Clients” dataset from Yeh and Lien (2009), available from the UCI Machine Learning Repository. The dataset includes 30,000 observations of Taiwanese credit card holders. Each entry contains 24 predictive variables and a binary indicator of default status (Yes = 1, No = 0) for the subsequent month. Variables include demographic details (such as age, gender, education, and marital status), credit limits, six months of historical billing amounts, repayment statuses, and payment records. This rich combination of demographic and historical financial data provides a strong foundation for employing predictive modeling approaches.</p>
<p>The project’s goal is to develop and evaluate several predictive models to accurately estimate the likelihood of credit card default. Machine learning is particularly suited for this task due to its ability to handle complex, nonlinear relationships, learn from large volumes of historical data, and dynamically adapt to various predictors. We begin by thoroughly cleaning and exploring the dataset to identify meaningful patterns. A basic logistic regression model establishes a baseline for performance. Subsequently, we experiment with more advanced approaches, including regularized regression, decision trees, ensemble methods (Random Forest and XGBoost), support vector machines, and a neural network model. Each model is rigorously evaluated using cross-validation and performance testing on a separate hold-out dataset. Evaluation criteria include metrics such as accuracy, AUC, precision, and recall, ensuring a comprehensive assessment of predictive performance. By identifying the most effective model and understanding the key factors influencing default risk, this study provides valuable insights that banks can use to improve their credit risk management strategies in practice.</p>
</section>
<section id="data-description-and-preprocessing" class="level2">
<h2 class="anchored" data-anchor-id="data-description-and-preprocessing">2 Data Description and Preprocessing</h2>
<p>The Default of Credit Card Clients dataset has 30,000 records. It includes 24 predictors and 1 response variable. The response shows if the client failed to pay their credit card bill the next month. The predictor variables fall into several groups:</p>
<div class="cell">
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<caption>Table 1 Variable descriptions for the Default of Credit Card Clients dataset</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Variable</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Type</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Limit_BAL</td>
<td style="text-align: left;">Numeric</td>
<td style="text-align: left;">Amount of given credit (NT dollar)</td>
</tr>
<tr class="even">
<td style="text-align: left;">SEX</td>
<td style="text-align: left;">Factor</td>
<td style="text-align: left;">Gender (Male, Female)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">EDUCATION</td>
<td style="text-align: left;">Factor</td>
<td style="text-align: left;">Education level (Graduate School, University, High School, Others)</td>
</tr>
<tr class="even">
<td style="text-align: left;">MARRIAGE</td>
<td style="text-align: left;">Factor</td>
<td style="text-align: left;">Marital status (Married, Single, Others)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AGE</td>
<td style="text-align: left;">Numeric</td>
<td style="text-align: left;">Age in years</td>
</tr>
<tr class="even">
<td style="text-align: left;">PAY_0 … PAY_6</td>
<td style="text-align: left;">Ordinal</td>
<td style="text-align: left;">Repayment status Sept 2005 to Apr 2005 (−1=on time; 1=1 month delay; … 9=≥9 months delay)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">BILL_AMT1–6</td>
<td style="text-align: left;">Numeric</td>
<td style="text-align: left;">Bill statement amount (NT dollar) Sept 2005 to Apr 2005</td>
</tr>
<tr class="even">
<td style="text-align: left;">PAY_AMT1–6</td>
<td style="text-align: left;">Numeric</td>
<td style="text-align: left;">Previous payment amount (NT dollar) Sept 2005 to Apr 2005</td>
</tr>
<tr class="odd">
<td style="text-align: left;">default</td>
<td style="text-align: left;">Factor</td>
<td style="text-align: left;">Default next month (Yes, No)</td>
</tr>
</tbody>
</table>


</div>
</div>
<div class="cell">
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<caption>Table 2 Summary statistics of the cleaned dataset (N = 30,000)</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Statistic</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">N</td>
<td style="text-align: right;">30000.0000</td>
</tr>
<tr class="even">
<td style="text-align: left;">Male</td>
<td style="text-align: right;">11888.0000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Female</td>
<td style="text-align: right;">18112.0000</td>
</tr>
<tr class="even">
<td style="text-align: left;">Mean age</td>
<td style="text-align: right;">35.4855</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Median Limit_BAL</td>
<td style="text-align: right;">140000.0000</td>
</tr>
<tr class="even">
<td style="text-align: left;">Mean Limit_BAL</td>
<td style="text-align: right;">167484.3227</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Default Count</td>
<td style="text-align: right;">6636.0000</td>
</tr>
<tr class="even">
<td style="text-align: left;">Default Rate (%)</td>
<td style="text-align: right;">22.1000</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>Table 2 provides a brief overview of the cleaned dataset:</p>
<ul>
<li>Demographics: 11,888 males (39.6%) and 18,112 females (60.4%); average age ~35.5 years (range 21–79). Most clients have a university or graduate-level education (~82% combined), while ~17% have high school or lower.</li>
<li>About 45.5% are single and 54.5% married, with a small fraction in “others” category.</li>
<li>Credit Limits: Mean credit limit is NT$167,484 (median NT$140,000), ranging from NT$10,000 to NT$1,000,000, indicating a wide variance in customer credit lines.</li>
<li>Payment History: The repayment status variables (PAY_0 to PAY_6) show that most values are 0 or -1 (meaning timely payments or paid in full), but there are also many instances of 1, 2, … up to 8. For the most recent month (PAY_0), the distribution has a large spike at 0/-1 and a long tail of positive delays; a small number of accounts even have status 8 or 9.</li>
<li>Bill and Payment Amounts: Bill amounts vary widely; for instance, the median bill in September 2005 (BILL_AMT1) is around NT$22,000, but the maximum is over NT$1,000,000. Payment amounts also vary, often being 0 for some months and ranging up to the tens or hundreds of thousands.</li>
</ul>
<p>Before starting the analysis, we looked for any unusual or missing values in the data. A few records had impossible values, so we changed them to “Others” or marked them as missing. We also scaled some continuous variables when needed for models that care about the size of numbers. In the end, we kept all 30,000 records and all features. The cleaned dataset was ready for analysis and modeling.</p>
</section>
<section id="exploratory-data-analysis" class="level2">
<h2 class="anchored" data-anchor-id="exploratory-data-analysis">3 Exploratory Data Analysis</h2>
<p>We started by exploring the data to see how the variables are spread out and how they might relate to default. Here are some main facts about the customers. Out of 30,000 clients, 22.1% missed their payment the next month. This means the data is imbalanced, with fewer defaults. The average age is about 35.5 years, with ages ranging from 21 to 79. Around 60% of the customers are women, and 40% are men. Most people went to college or graduate school, while the rest finished high school or less. About 54.5% are married, and 45.5% are single. Only a small number belong to other marital groups. The average credit limit is 167,484 NTD, and the median is 140,000 NTD. Credit limits range from 10,000 to 1,000,000 NTD, showing that customers differ a lot in how much credit they have.</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Table 3 Default rate by demographic factor</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Factor</th>
<th style="text-align: left;">Level</th>
<th style="text-align: right;">Count</th>
<th style="text-align: right;">Default Rate (%)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Gender</td>
<td style="text-align: left;">Male</td>
<td style="text-align: right;">11888</td>
<td style="text-align: right;">24.2</td>
</tr>
<tr class="even">
<td style="text-align: left;">Gender</td>
<td style="text-align: left;">Female</td>
<td style="text-align: right;">18112</td>
<td style="text-align: right;">20.8</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Education</td>
<td style="text-align: left;">Graduate School</td>
<td style="text-align: right;">10585</td>
<td style="text-align: right;">19.2</td>
</tr>
<tr class="even">
<td style="text-align: left;">Education</td>
<td style="text-align: left;">University</td>
<td style="text-align: right;">14030</td>
<td style="text-align: right;">23.7</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Education</td>
<td style="text-align: left;">High School</td>
<td style="text-align: right;">4917</td>
<td style="text-align: right;">25.2</td>
</tr>
<tr class="even">
<td style="text-align: left;">Education</td>
<td style="text-align: left;">Others</td>
<td style="text-align: right;">468</td>
<td style="text-align: right;">7.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Marital Status</td>
<td style="text-align: left;">Married</td>
<td style="text-align: right;">13659</td>
<td style="text-align: right;">23.5</td>
</tr>
<tr class="even">
<td style="text-align: left;">Marital Status</td>
<td style="text-align: left;">Single</td>
<td style="text-align: right;">15964</td>
<td style="text-align: right;">20.9</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Marital Status</td>
<td style="text-align: left;">Others</td>
<td style="text-align: right;">377</td>
<td style="text-align: right;">23.6</td>
</tr>
</tbody>
</table>
</div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Table 4 Mean age and credit limit by default status</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Default Status</th>
<th style="text-align: right;">Mean Age</th>
<th style="text-align: right;">Mean Limit_BAL</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">No</td>
<td style="text-align: right;">35.4</td>
<td style="text-align: right;">178100</td>
</tr>
<tr class="even">
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">35.7</td>
<td style="text-align: right;">130110</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Some key observations from the EDA include:</p>
<ul>
<li>Demographic Factors:</li>
</ul>
<p>Table 3 shows that default rates vary little across demographic groups. Men defaulted at 24.2%, and women at 20.8%, suggesting gender has little impact. Education showed a slight trend: graduate degree holders had the lowest default rate (19.2%), university graduates were at 23.7%, and high school graduates had the highest rate (25.2%). This may suggest that higher education is linked to better credit management. The “Other/Unknown” education group had a low rate of 7.1%, but the sample was small. Marital status also made little difference, with default rates of 23.5% for married clients, 20.9% for singles, and 23.6% for others. Overall, demographic factors had only a weak relationship with default risk.</p>
<ul>
<li>Credit Limit and Age:</li>
</ul>
<p>Table 4 compares age and credit limits between defaulters and non-defaulters. The average age was nearly the same—35.7 for defaulters and 35.4 for non-defaulters. This shows that age is not a useful predictor. Credit limit, however, showed a clear difference. Non-defaulters had a higher average limit of NTD 178,100, while defaulters had a lower average of NTD 130,110. This suggests that people with lower limits were more likely to default. It also implies the bank gave smaller limits to higher-risk clients. Overall, a higher credit limit—possibly reflecting better credit history—was linked to a lower chance of default.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="final_project_files/figure-html/side_by_side_patchwork-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Payment History and Default: The strongest pattern was between recent payment history and default. As PAY_0 increased, default risk rose sharply. Clients who paid on time or had no balance had low default rates, around 12% to 17%. A one-month delay raised the rate to 33.9%. Two months late pushed it to 69%. Three or more months late led to rates above 75%. For example, PAY_0 = 3 had a 75.8% default rate, and PAY_0 = 7 reached 77.8%. This shows that recent late payments are the clearest warning sign. Similar trends appeared in PAY_2 through PAY_6. Even older missed payments still increased risk. Overall, recent payment behavior was the most important predictor of default in the dataset.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="final_project_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:50.0%"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Table 5 Summary of Key Correlations</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Feature</th>
<th style="text-align: center;">Pearson r</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Bill-statement correlations</td>
<td style="text-align: center;">0.80 – 0.95</td>
</tr>
<tr class="even">
<td style="text-align: left;">Mean payment-amount correlation</td>
<td style="text-align: center;">0.19</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li>Bill and Payment Amount Patterns:</li>
</ul>
<p>We also examined how the financial variables relate to each other. The six bill amounts (BILL_AMT1 to BILL_AMT6) were strongly correlated, with values between 0.80 and 0.95. This is expected—customers with high bills in one month often have high bills in later months. In contrast, the six payment amounts (PAY_AMT1 to PAY_AMT6) were weakly related. Their average correlation was only 0.19, showing that payment amounts vary more month to month.</p>
<p>When we compared defaulters and non-defaulters, we saw that defaulters made much smaller payments relative to their bills. Their bill amounts were only slightly lower, but they paid back far less. This suggests that low repayment behavior—rather than high debt—may signal default risk. Table 5 shows that while balances were similar, defaulters paid a much smaller share. Many defaulters kept their debt high by making only minimal payments.</p>
<p>Overall, our data exploration shows that payment behavior is the strongest sign of default risk. Demographic factors and credit limits do matter a little, but they are less important once we look at payment history. These findings will help us build better models. We expect that models using payment history will do a good job predicting who will default.</p>
</section>
<section id="linear-regression-analysis" class="level2">
<h2 class="anchored" data-anchor-id="linear-regression-analysis">4 Linear Regression Analysis</h2>
<p>Before we started predicting defaults, we first used linear regression to explore what affects the credit limit (LIMIT_BAL) a client gets from the bank. This is a regression problem that helps us understand how the bank decides credit limits and what kind of customers get more or less credit. This is useful because credit limits might show how much the bank trusts a client—and that could also relate to default risk. We built a model with credit limit as the outcome and age, sex, education, and marital status as the predictors. By looking at the model results, we can see which kinds of clients usually get higher or lower credit limits, even after accounting for the other factors. Here is a summary of what we found:</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Table 6 Linear Regression Coefficients for Credit Limit Model</caption>
<colgroup>
<col style="width: 28%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 10%">
<col style="width: 25%">
<col style="width: 6%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Term</th>
<th style="text-align: right;">Estimate</th>
<th style="text-align: right;">Std. Error</th>
<th style="text-align: right;">t value</th>
<th style="text-align: right;">Pr(&gt;|t|)</th>
<th style="text-align: center;">Sig</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Intercept</td>
<td style="text-align: right;">138161.23</td>
<td style="text-align: right;">4015.50</td>
<td style="text-align: right;">34.41</td>
<td style="text-align: right;">0</td>
<td style="text-align: center;">***</td>
</tr>
<tr class="even">
<td style="text-align: left;">Age (years)</td>
<td style="text-align: right;">2356.91</td>
<td style="text-align: right;">88.84</td>
<td style="text-align: right;">26.53</td>
<td style="text-align: right;">0</td>
<td style="text-align: center;">***</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Female (vs Male)</td>
<td style="text-align: right;">11327.48</td>
<td style="text-align: right;">1451.83</td>
<td style="text-align: right;">7.80</td>
<td style="text-align: right;">0</td>
<td style="text-align: center;">***</td>
</tr>
<tr class="even">
<td style="text-align: left;">Univ (vs Grad)</td>
<td style="text-align: right;">-69607.39</td>
<td style="text-align: right;">1585.97</td>
<td style="text-align: right;">-43.89</td>
<td style="text-align: right;">0</td>
<td style="text-align: center;">***</td>
</tr>
<tr class="odd">
<td style="text-align: left;">EDUCATIONHigh School</td>
<td style="text-align: right;">-103912.80</td>
<td style="text-align: right;">2169.14</td>
<td style="text-align: right;">-47.91</td>
<td style="text-align: right;">0</td>
<td style="text-align: center;">***</td>
</tr>
<tr class="even">
<td style="text-align: left;">Others (vs Grad)</td>
<td style="text-align: right;">-38905.45</td>
<td style="text-align: right;">5769.61</td>
<td style="text-align: right;">-6.74</td>
<td style="text-align: right;">0</td>
<td style="text-align: center;">***</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Single (vs Married)</td>
<td style="text-align: right;">-18970.46</td>
<td style="text-align: right;">1622.90</td>
<td style="text-align: right;">-11.69</td>
<td style="text-align: right;">0</td>
<td style="text-align: center;">***</td>
</tr>
<tr class="even">
<td style="text-align: left;">Other Marital Status</td>
<td style="text-align: right;">-68883.26</td>
<td style="text-align: right;">6382.17</td>
<td style="text-align: right;">-10.79</td>
<td style="text-align: right;">0</td>
<td style="text-align: center;">***</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Key Results from the Linear Model Predicting Credit Limit</p>
<ol type="1">
<li>Age</li>
</ol>
<p>The estimated coefficient for AGE is 2 356.91 (SE = 88.84, t(29992) = 26.53, p &lt; .001). This means that, holding all else constant, each additional year of age is associated with an average increase of NT$ 2356.91 in a client’s credit limit. A 95 % confidence interval for this effect is approximately. <span class="math display">\[
2356.91 \pm 1.96 \times 88.84 \approx [2182, 2531] \ \text{NT\$}.
\]</span> Although modest, this positive relationship is plausible—older customers often have longer credit histories and potentially higher incomes.</p>
<ol start="2" type="1">
<li>Gender (Sex)</li>
</ol>
<p>The regression included a variable for Female, with Male as the baseline. The results showed that female clients had, on average, NT$11,300 higher credit limits than similar male clients (coefficient ≈ +11,327, p &lt; 0.001). This was somewhat surprising. It may reflect differences in credit profiles or bank policies. Female clients in this dataset may have had traits the bank favored, even after adjusting for income and other factors.</p>
<ol start="3" type="1">
<li>Education</li>
</ol>
<p>We used indicator variables for education, with Graduate School as the reference. The model showed that clients with less education had lower credit limits. University graduates had about NT$69,600 less credit than graduates (p &lt; 0.001). High school graduates had about NT$103,900 less (p &lt; 0.001). Those in the “Other” category had about NT$38,900 less (p &lt; 0.001). This suggests the bank gives higher limits to more educated clients, likely due to higher income or more stable jobs.</p>
<ol start="4" type="1">
<li>Marital Status</li>
</ol>
<p>Using Married as the baseline, the model showed that Single clients had about NT$19,000 lower credit limits on average (p &lt; 0.001). Clients in the “Other” category had about NT$68,900 less than married clients (p &lt; 0.001). This suggests that married individuals tend to receive higher credit limits. This may reflect greater financial stability or dual incomes, while the “Other” group may include less stable situations.</p>
<ol start="5" type="1">
<li>Model Fit</li>
</ol>
<p>Although the demographic effects were statistically significant, they explained little overall. The model’s <span class="math inline">\(R^2\)</span> was just 0.1156, meaning only 11.6% of the variation in credit limits came from age, gender, education, and marital status. This is expected, since banks likely consider many other factors like income, job status, and credit history. So, while demographics matter somewhat—older, more educated, and married clients tend to get higher limits—they account for only a small part of the bank’s decisions.</p>
<p>The regression shows that demographics do affect credit limits, but the impact is small. Older, female, well-educated, and married clients tend to get higher limits. Younger, less-educated, and single clients usually get lower limits. However, these traits explain only a small part of the bank’s decision. Other factors, like income or credit history, likely play a bigger role. Still, this result is useful. If credit limits relate to demographics, these traits might also link to default risk. In the next steps, we’ll test whether age, education, and marital status help predict default, even if they are weaker than payment history.</p>
</section>
<section id="logistic-regression-analysis" class="level2">
<h2 class="anchored" data-anchor-id="logistic-regression-analysis">5 Logistic Regression Analysis</h2>
<p>The main goal of our project is to predict whether a customer will default next month (a yes/no outcome). For this kind of problem, logistic regression is a good starting point. It is often used in credit scoring because it models the chance of default using the input features. It also helps us understand how each variable affects default risk and gives us a baseline to compare more advanced models.</p>
<p>We used all 24 predictors in the model. We split the data into a training set (80%, or 24,000 cases) and a test set (20%, or 6,000 cases). We trained the model using 10-fold cross-validation on the training data to reduce overfitting. This method also helped us check how well the model performs.</p>
<p>Cross-validation Performance: In cross-validation, the logistic model got an average AUC of about 0.72, which shows it has moderate ability to tell defaulters from non-defaulters. When using a cutoff of 0.5, the model did well at identifying non-defaulters (about 97% correct), but it did poorly at catching defaulters—only 25–30% of them were correctly flagged. In short, the model often said “No Default” even when some people did default.</p>
<p>This problem is common when the dataset is imbalanced, like ours (only 22.1% are defaulters). If a model predicts “No Default” for everyone, it still gets 77.9% accuracy. But that’s not helpful because it misses most real defaulters. So the goal is to do better than this baseline, while not wrongly labeling too many safe customers as risky.</p>
<p>Overall, the cross-validation showed that the logistic model was better than random guessing (AUC ~0.72), but it was cautious in predicting defaults. We will try to improve on this with stronger models or better cutoff values.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = No, case = Yes</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="final_project_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:50.0%"></p>
</figure>
</div>
</div>
</div>
<p>After training, we applied the logistic model to the hold-out test set of 6,000 clients to evaluate its real performance. The results on the test set were consistent with the cross-validation findings. The model’s confusion matrix on the test data is summarized below:</p>
<div class="cell">
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<caption>Table 7 Confusion Matrix Counts</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Predicted \ Actual</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">No</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Yes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">No</td>
<td style="text-align: right;">4541</td>
<td style="text-align: right;">997</td>
</tr>
<tr class="even">
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">131</td>
<td style="text-align: right;">330</td>
</tr>
</tbody>
</table>


</div>
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<caption>Table 8 Derived Performance Metrics</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Metric</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Accuracy</td>
<td style="text-align: right;">0.812</td>
</tr>
<tr class="even">
<td style="text-align: left;">Sensitivity (Recall)</td>
<td style="text-align: right;">0.249</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Specificity</td>
<td style="text-align: right;">0.972</td>
</tr>
<tr class="even">
<td style="text-align: left;">Precision (Pos Pred Value)</td>
<td style="text-align: right;">0.716</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Negative Pred Value</td>
<td style="text-align: right;">0.820</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>From this, we computed:</p>
<ul>
<li><p>Accuracy was 81.2%. The model correctly predicted 81% of 6,000 test cases. This was better than the null accuracy of 77.9%, which reflects always guessing “No default.” A test (p &lt; 1e-9) confirmed this was significantly better than chance.</p></li>
<li><p>Sensitivity (Recall) was 24.9%. The model found only 330 of 1,327 actual defaulters. It missed about 75%. This shows the model is cautious and mostly predicts “No default.”</p></li>
<li><p>Specificity was 97.2%. It correctly identified 4,541 of 4,673 non-defaulters. The model rarely labeled safe customers as risky.</p></li>
<li><p>Precision was 71.6%. When it predicted default, it was right 72% of the time. It flagged few people, but those flags were usually correct.</p></li>
<li><p>Negative Predictive Value was 82.0%. Most people labeled “No default” were truly safe.</p></li>
<li><p>Balanced Accuracy was 61.0%. This average of sensitivity and specificity shows the model performs better on non-defaulters.</p></li>
</ul>
<p>The logistic model was good at spotting safe clients, but it missed most defaulters. That’s common with imbalanced data and a default threshold of 0.5. We didn’t adjust this threshold in the baseline model, but doing so could improve recall.</p>
<p>Even with its limits, the model gave useful insights. Its coefficients show which features affect the odds of default.</p>
<ol type="1">
<li><p>Payment status (PAY_0–PAY_6): These were the top predictors. For example, if PAY_0 increases by one level (e.g., from on-time to one month late), the odds of default go up about 4 times. More months late means even higher risk. This matches our earlier findings.</p></li>
<li><p>Credit limit (Limit_BAL): The coefficient was slightly negative. Customers with higher limits were a bit less likely to default. It suggests banks assign higher limits to more reliable clients.</p></li>
<li><p>Bill and payment amounts (BILL_AMT1–6, PAY_AMT1–6): These added little extra value once payment status was included. Their coefficients were small. This is likely due to overlap across months. Whether someone is behind matters more than how much they owe or paid.</p></li>
<li><p>Demographics (AGE, SEX, EDUCATION, MARRIAGE): These had minor effects. For example, having a university degree slightly reduced risk. Age, gender, and marital status had very small impacts. These traits help a little, but not as much as payment history.</p></li>
</ol>
<p>In summary, the logistic model highlights one key point: recent delinquency is the strongest signal of default. Other features—like credit limit or demographics—matter less. But the model is limited. It’s linear and misses most defaulters. To improve, we need more flexible models that can capture complex patterns.</p>
</section>
<section id="tree-based-models" class="level2">
<h2 class="anchored" data-anchor-id="tree-based-models">6 Tree-Based Models</h2>
<p>Decision trees and their ensemble variants often perform well for classification tasks like default prediction, as they can capture nonlinear interactions among predictors and handle heterogeneous relationships without requiring the input features to be scaled or transformed. We explored both a single decision tree model and two tree ensemble methods: a Random Forest and XGBoost. These methods were trained on the same 80% training set and evaluated on the 20% test set.</p>
<section id="decision-tree" class="level3">
<h3 class="anchored" data-anchor-id="decision-tree">6.1 Decision Tree</h3>
<p>We first trained a single classification tree using the CART algorithm. To avoid overfitting, we pruned the tree based on cross-validation: the complexity parameter was set to cp = 0.002, which resulted in a tree of depth 4. This pruned tree represented a set of simple decision rules for predicting default.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="final_project_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:50.0%"></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Table 9 Decision Tree: Confusion Matrix Counts</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Predicted &nbsp;Actual</th>
<th style="text-align: right;">No</th>
<th style="text-align: right;">Yes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">No</td>
<td style="text-align: right;">4494</td>
<td style="text-align: right;">899</td>
</tr>
<tr class="even">
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">178</td>
<td style="text-align: right;">428</td>
</tr>
</tbody>
</table>
</div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Table 10 Decision Tree: Performance Metrics</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Metric</th>
<th style="text-align: right;">Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Accuracy</td>
<td style="text-align: right;">0.820</td>
</tr>
<tr class="even">
<td style="text-align: left;">Sensitivity (Recall)</td>
<td style="text-align: right;">0.323</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Specificity</td>
<td style="text-align: right;">0.962</td>
</tr>
<tr class="even">
<td style="text-align: left;">Precision (Pos Pred Value)</td>
<td style="text-align: right;">0.706</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Negative Pred Value</td>
<td style="text-align: right;">0.833</td>
</tr>
</tbody>
</table>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="final_project_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:50.0%"></p>
</figure>
</div>
</div>
</div>
<p>The decision tree model had a simple and intuitive structure. Its top split was on PAY_0, the most recent payment status. This matches what we expected based on earlier analysis. The tree’s first question was: Did the customer have a delay last month? If PAY_0 was 0 or -1 (on time or early), the tree followed one path. If PAY_0 was 1 or more (late), it followed another.</p>
<p>The next important splits were on PAY_3, PAY_2, and BILL_AMT1. These variables represent the payment status from two to three months ago, and the amount of the most recent bill. The tree used them to refine its prediction. This confirms again that recent payment behavior and current balance are key factors in default risk—even in a basic model like this one.</p>
<p>A key advantage of a decision tree is that it is easy to interpret. It gives clear, rule-based decisions. For example, one path in our tree led to this rule:</p>
<ul>
<li>Rule: If PAY_0 ≥ 2 and PAY_3 &lt; 0, then predict default = Yes.</li>
<li>Estimated probability of default: ≈ 0.71.</li>
</ul>
<p>This rule flags customers who were on time three months ago but are now two months behind. It suggests that a sudden recent delinquency, even after a good history, signals serious risk. This makes sense. A borrower who has just started falling behind may be facing new financial stress. This rule can easily be explained to managers and stakeholders.</p>
<p>Performance of the Decision Tree: On the test set, the pruned decision tree reached about 82.0% accuracy and a ROC AUC of 0.65. It found more defaulters than logistic regression, with a sensitivity of 32%. However, it had lower specificity and a lower AUC than logistic regression (0.65 vs.&nbsp;0.72). This means it caught more defaulters, but it was worse at ranking risk overall.</p>
<p>This is a typical trade-off. The tree used sharp splits to find some defaulters more clearly. But as a single tree, it may also overfit and fail to generalize to new data.</p>
<p>While its performance was not as strong as the advanced models we explore next, the tree is still valuable. It is transparent and easy to explain. In real-world use—especially where decisions must be interpretable—a decision tree can still be a practical option.</p>
</section>
<section id="random-forest" class="level3">
<h3 class="anchored" data-anchor-id="random-forest">6.2 Random Forest</h3>
<p>Next, we used a Random Forest model. This is an ensemble method that builds many decision trees on random parts of the training data and combines their results. Random Forests usually give better accuracy and are more stable than a single tree, but they are harder to interpret. We trained the model with 100 trees (ntree = 100) and kept the other settings at their defaults.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Table 11 Random Forest: Confusion Matrix Counts</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Predicted &nbsp;Actual</th>
<th style="text-align: right;">No</th>
<th style="text-align: right;">Yes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">No</td>
<td style="text-align: right;">4422</td>
<td style="text-align: right;">832</td>
</tr>
<tr class="even">
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">250</td>
<td style="text-align: right;">495</td>
</tr>
</tbody>
</table>
</div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Table 12 Random Forest: Performance Metrics</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Metric</th>
<th style="text-align: right;">Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Accuracy</td>
<td style="text-align: right;">0.820</td>
</tr>
<tr class="even">
<td style="text-align: left;">Sensitivity (Recall)</td>
<td style="text-align: right;">0.373</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Specificity</td>
<td style="text-align: right;">0.946</td>
</tr>
<tr class="even">
<td style="text-align: left;">Precision (Pos Pred Value)</td>
<td style="text-align: right;">0.664</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Negative Pred Value</td>
<td style="text-align: right;">0.842</td>
</tr>
</tbody>
</table>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="final_project_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:50.0%"></p>
</figure>
</div>
</div>
</div>
<p>The random forest model got an accuracy of 81.7% on the test set, which is close to the accuracy of both the single decision tree and the logistic model. But it did much better at finding defaulters. It correctly identified about 497 out of 1,327 defaulters, giving a recall of about 37.5%. This is much better than the logistic model, which only caught about 25%. So, the random forest found about 13% more defaulters.</p>
<p>The downside was a small increase in false alarms. It marked more non-defaulters as defaulters, so its specificity dropped to about 94.2% (compared to 97% for logistic). This is a normal trade-off when trying to improve recall. The precision—how many predicted defaulters were actually defaulters—was about 65%.</p>
<p>The model’s ROC AUC was 0.76, better than the logistic model’s 0.72 and much better than the single tree’s 0.65. This shows that the random forest ranked risky and safe customers more accurately. It did this by finding patterns that simpler models missed.</p>
<p>In summary, the random forest showed that using many trees together helps catch more defaulters and improves the model’s overall ranking ability (AUC). It still kept high accuracy for non-defaulters, so it gave a better balance for handling this imbalanced dataset than the logistic model.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="final_project_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:50.0%"></p>
</figure>
</div>
</div>
</div>
<p>Besides accuracy, random forests also show which features matter most for predictions. We looked at the importance scores based on Gini impurity. The top feature by far was PAY_0, which matches everything we’ve seen—recent late payments are a strong warning sign. The next most important features were the bill amounts from the last three months: BILL_AMT1, BILL_AMT2, and BILL_AMT3. This shows that high recent balances also raise the risk of default.</p>
<p>Interestingly, AGE also showed up as one of the top features. This means that even after the model uses payment and balance data, it still finds some helpful signal in age. This fits with what we noticed earlier: younger borrowers may be slightly more at risk, though the effect is small. Some other payment status and payment amount features also mattered, but none were as strong as PAY_0 and the recent bill amounts.</p>
<p>Together, these top features reflect two key risks: missing payments and carrying high balances. This confirms what we saw in earlier analysis—if you want to predict default, focus on whether the customer has been paying on time and how much they owe.</p>
</section>
<section id="xgboost" class="level3">
<h3 class="anchored" data-anchor-id="xgboost">6.3 XGBoost</h3>
<p>We also used Extreme Gradient Boosting (XGBoost), which is a newer and often stronger method for building tree ensembles. Gradient boosting builds trees one at a time, with each new tree trying to fix the mistakes made by the previous ones. XGBoost is a popular version of this method because it includes tools to prevent overfitting and is known for its speed and strong performance. It’s widely used in machine learning competitions.</p>
<p>We trained the XGBoost model in R using the xgboost package and set it up for binary classification with a logistic objective. For tuning, we used part of the training data as a validation set and applied early stopping. We mostly used the default settings and did not spend much time tuning details like learning rate or tree depth due to time limits. So while the model wasn’t fully optimized, it should still perform well.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Table 13 XGBoost: Confusion Matrix Counts</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Predicted &nbsp;Actual</th>
<th style="text-align: right;">No</th>
<th style="text-align: right;">Yes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">No</td>
<td style="text-align: right;">4404</td>
<td style="text-align: right;">847</td>
</tr>
<tr class="even">
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">268</td>
<td style="text-align: right;">480</td>
</tr>
</tbody>
</table>
</div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Table 14 XGBoost: Performance Metrics</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Metric</th>
<th style="text-align: right;">Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Accuracy</td>
<td style="text-align: right;">0.814</td>
</tr>
<tr class="even">
<td style="text-align: left;">Sensitivity (Recall)</td>
<td style="text-align: right;">0.362</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Specificity</td>
<td style="text-align: right;">0.943</td>
</tr>
<tr class="even">
<td style="text-align: left;">Precision (Pos Pred Value)</td>
<td style="text-align: right;">0.642</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Negative Predictive Value</td>
<td style="text-align: right;">0.839</td>
</tr>
</tbody>
</table>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="final_project_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:50.0%"></p>
</figure>
</div>
</div>
</div>
<p>Performance: The XGBoost model performed about the same as the random forest on the test data. It had an accuracy of 81.4%, which is similar to both the forest and logistic models. For finding defaulters, it had a sensitivity of about 36%, close to the random forest’s 37.5%. This means it caught around one-third of the defaulters. The precision was about 64.2%, also close to the forest’s 65%. The F<sub>1</sub>-score for the default class was around 0.46, showing a good balance between precision and recall.</p>
<p>The ROC AUC for XGBoost was about 0.760, nearly the same as the random forest. So, in this case, gradient boosting did not clearly beat the random forest. Both models improved a lot over simpler methods like logistic regression and decision trees, especially in finding defaulters, while still keeping high overall accuracy. The random forest did slightly better in recall (38% vs.&nbsp;36%), while XGBoost had similar precision and AUC. The differences are small, so both models are effective, and neither one is clearly better without more tuning.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="final_project_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:50.0%"></p>
</figure>
</div>
</div>
</div>
<p>To understand the XGBoost model better, we looked at which features it found most important. The results were very similar to what we saw in the random forest. PAY_0 was by far the most important feature. Next came BILL_AMT1 (September bill) and PAY_AMT1 (September payment), both with high importance scores (around 0.16–0.17). Other key features included PAY_AMT3, BILL_AMT6, and PAY_AMT4, which also had good importance scores (about 0.13–0.15). Rounding out the top ten were LIMIT_BAL (credit limit), AGE, PAY_2, and BILL_AMT2, each with scores around 0.12–0.14.</p>
<p>XGBoost’s top features included a mix of payment status, bill amounts, and payment amounts. This suggests it picked up interactions—for example, it may look at how much someone paid compared to what they owed and whether they were late. This was a little different from the random forest, which focused more on balances and status alone. Boosting models like XGBoost can catch these more detailed patterns, which may explain why payment amounts like PAY_AMT1 mattered more here.</p>
<p>Still, PAY_0 was the most important feature in both models. Both XGBoost and random forest agree that recent payment behavior and current debt are the strongest signs of default risk. They just use this information in more flexible and complex ways to improve accuracy.</p>
<p>Comparison: At this point, both Random Forest and XGBoost clearly perform better than the simpler models. Random Forest had a slight edge in recall, while XGBoost was close in recall and slightly better in precision or calibration. Both had an AUC around 0.76. In practice, the choice between them might depend on other factors: Random Forest is easier to train and explain, while XGBoost can be more powerful if fine-tuned and may work better with very large datasets. For our project, we’ll include both in the final model comparison, but it’s clear that these advanced ensemble models greatly improve our ability to predict default.</p>
</section>
</section>
<section id="support-vector-machine" class="level2">
<h2 class="anchored" data-anchor-id="support-vector-machine">7 Support Vector Machine</h2>
<p>As another method, we tested a Support Vector Machine (SVM) with a radial basis function (RBF) kernel. SVMs are strong classifiers that work well with complex, nonlinear patterns. Unlike decision trees, SVMs don’t split features into parts. Instead, they try to draw the best boundary between the two classes by creating the widest possible margin. The RBF kernel helps the model find curved or flexible boundaries in the original feature space.</p>
<p>We performed a 5-fold cross-validated grid search to tune the SVM’s regularization parameter C (the cost parameter) for the RBF kernel. We tested values C ∈ {0.01, 0.1, 1, 10, 100} and selected the value that gave the highest cross-validated AUC on the training set. The best performing C was 1, which we then used to train the final SVM on the full training set.</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Table 15 : SVM (RBF): Confusion Matrix Counts</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Predicted &nbsp;Actual</th>
<th style="text-align: right;">No</th>
<th style="text-align: right;">Yes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">No</td>
<td style="text-align: right;">4496</td>
<td style="text-align: right;">906</td>
</tr>
<tr class="even">
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">176</td>
<td style="text-align: right;">421</td>
</tr>
</tbody>
</table>
</div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Table 16 SVM (RBF): Performance Metrics</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Metric</th>
<th style="text-align: right;">Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Accuracy</td>
<td style="text-align: right;">0.820</td>
</tr>
<tr class="even">
<td style="text-align: left;">Sensitivity (Recall)</td>
<td style="text-align: right;">0.317</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Specificity</td>
<td style="text-align: right;">0.962</td>
</tr>
<tr class="even">
<td style="text-align: left;">Precision (Pos Pred Value)</td>
<td style="text-align: right;">0.705</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Negative Predictive Value</td>
<td style="text-align: right;">0.832</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>On the test set, the SVM with a radial kernel reached an overall accuracy of about 81.96%, which is nearly the same as the other models. Its ROC AUC was about 0.72, similar to the logistic regression but lower than the tree-based models like Random Forest and XGBoost.</p>
<p>From the confusion matrix, we found the following:</p>
<ul>
<li><p>Sensitivity (Recall) = 0.317 (approximately 31.7% of defaulters caught). The SVM caught about one-third of the defaulters. This is better than logistic regression (which caught only 25%), but not as good as Random Forest, XGBoost, or the neural network (which reached around 36–38%). So, SVM improved over the simple model, but still missed about two-thirds of the defaulters.</p></li>
<li><p>Specificity = 0.962 (about 96.2% of non-defaulters correctly classified). The SVM correctly labeled most non-defaulters, making only a few false alarms (about 3.8%). This is slightly lower than logistic’s 97%, but still quite good.</p></li>
<li><p>Precision = 0.705 (approximately 70.5% of those predicted to default were actual defaulters). Of the customers SVM predicted as defaulters, about 70% actually were. This is close to logistic regression (~72%) and better than the tree models (~65%), meaning SVM’s default warnings are fairly reliable.</p></li>
</ul>
<p>Overall, the SVM model found a balance. It caught more defaulters than logistic regression, while still keeping most of its predictions accurate. Its balanced accuracy (average of sensitivity and specificity) was about 0.72—simliar than logistic’s ~0.72, but still not as high as the tree ensemble models (~0.65).</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="final_project_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:50.0%"></p>
</figure>
</div>
</div>
</div>
<p>Interpretation: The SVM performed fairly well overall. It offered a good middle ground—better at catching defaulters than the logistic model, but not as strong as the tree-based models. This result makes sense. SVMs can work well in problems with many features, but tree ensembles often do better when the data has a mix of types (like categories and numbers) and complex patterns.</p>
<p>Also, we didn’t spend much time tuning the SVM’s kernel settings, which might have improved its performance.</p>
<p>In practical terms, SVMs are harder to interpret. Unlike trees, they don’t give clear rules or show which features matter most. Since its AUC was close to logistic regression and lower than the tree models, we probably wouldn’t choose SVM as our final model. Still, it was useful to try it—it shows that using nonlinear methods helps, but in this case, tree-based models were a better fit for the data.</p>
</section>
<section id="neural-network" class="level2">
<h2 class="anchored" data-anchor-id="neural-network">8 Neural Network</h2>
<p>As a final approach, we built a simple neural network for classification. Like SVMs, neural networks can model complex, nonlinear patterns. They work by using layers of connected units to learn flexible decision boundaries, and with enough layers and hidden units, they can model almost any relationship in the data.</p>
<p>In fact, the original study by Yeh &amp; Lien (2009) found that a neural network was the best single model for predicting default among the methods they tested. They used a three-layer backpropagation network. For our project, we created a basic version using the nnet package in R.</p>
<p>Our neural network had the following architecture and settings:</p>
<ul>
<li>One hidden layer with 5 neurons.</li>
<li>An output layer with a single neuron, producing a probability via the logistic function.</li>
<li>We used a weight decay parameter of 0.1 to prevent overfitting, which penalizes large weights.</li>
<li>We standardized all input features to mean 0 and variance 1 before training, which helps the network converge and treats all features on equal footing.</li>
<li>We trained the network with default settings for the optimization.</li>
</ul>
<p>This network is quite small, so it’s essentially able to capture some nonlinear combinations of the inputs but is not overly expressive. We chose a small network due to the limited complexity we wanted and also computational simplicity.</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Table 17 Neural Network: Confusion Matrix Counts</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Predicted &nbsp;Actual</th>
<th style="text-align: right;">No</th>
<th style="text-align: right;">Yes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">No</td>
<td style="text-align: right;">4411</td>
<td style="text-align: right;">827</td>
</tr>
<tr class="even">
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">261</td>
<td style="text-align: right;">500</td>
</tr>
</tbody>
</table>
</div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Table 18 Neural Network: Performance Metrics</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Metric</th>
<th style="text-align: right;">Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Accuracy</td>
<td style="text-align: right;">0.819</td>
</tr>
<tr class="even">
<td style="text-align: left;">Sensitivity (Recall)</td>
<td style="text-align: right;">0.377</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Specificity</td>
<td style="text-align: right;">0.944</td>
</tr>
<tr class="even">
<td style="text-align: left;">Precision (Pos Pred Value)</td>
<td style="text-align: right;">0.657</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Negative Predictive Value</td>
<td style="text-align: right;">0.842</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Performance: Even though the neural network was simple, it performed about the same as the tree ensemble models on the test set. It reached about 81.9% accuracy, just like Random Forest, XGBoost, and SVM (all between 81–82%). Its ROC AUC was about 0.774, which was a little higher than the tree ensembles (~0.76).</p>
<p>The confusion matrix showed: - Sensitivity (Recall) ≈ 0.377 (about 37.7%). The network correctly identified about 500 out of 1,327 defaulters, almost the same as Random Forest (37.5%). This is much better than logistic regression (25%) and matches the best models we tried. - Specificity ≈ 0.944 (about 94.4% of non-defaulters correctly identified). That means it made slightly more false alarms than logistic or SVM, but it was very similar to Random Forest. - Precision ≈ 0.657 (around 65.7% of predicted defaulters were actual defaulters), again in the same range as Random Forest and XGBoost. The F<sub>1</sub>-score for defaults was around 0.48, very close to the others (~0.46 for RF/XGB).</p>
<p>In summary, the neural network’s results were almost the same as Random Forest’s. It caught about the same number of defaulters and made a similar number of mistakes. This is interesting because it shows that even a basic neural net can reach the level of more complex tree models on this dataset. One reason might be that our 5-node hidden layer was enough to learn useful patterns—similar to how a tree learns decision rules.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="final_project_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:50.0%"></p>
</figure>
</div>
</div>
</div>
<p>With more tuning, the neural network might perform even better. We could try adding more hidden units, using a second hidden layer, testing different activation functions or training methods, or switching to modern deep learning tools like TensorFlow or Keras for more advanced designs. For example, Yeh and Lien (2009) used a three-layer neural network and found it did better than logistic regression and discriminant analysis (though they didn’t compare it to boosting or random forests). Our one-layer network did well, but it wasn’t clearly the best—it matched the top models but didn’t outperform them. A deeper network or an ensemble of networks might improve results further, though it would be more complex and take more time to train.</p>
<p>One strength of neural networks is that, if complex enough, they can learn to act like other models. In our case, even with just 5 neurons, the network seems to have learned patterns similar to what tree models would find. It reached an AUC of 0.77, which was the highest of all the models we trained. This suggests that the neural net may have ranked risky and safe customers more precisely.</p>
<p>However, there are trade-offs. Neural networks are harder to explain—they are “black boxes,” unlike decision trees or logistic models, which provide clear rules and feature importance. That’s a drawback in business settings where interpretability matters. Also, neural networks can overfit if not tuned well, though we used weight decay to help avoid that.</p>
<p>In conclusion, even a simple neural network matched the best tree-based models in terms of prediction. This shows that the patterns in the data are clear enough to be learned by different kinds of models. For our final model comparison, we’ll include the neural network along with Random Forest and XGBoost, while noting that deeper neural nets might do even better with more tuning.</p>
</section>
<section id="variable-selection-with-lasso-and-ridge" class="level2">
<h2 class="anchored" data-anchor-id="variable-selection-with-lasso-and-ridge">9 Variable Selection with LASSO and Ridge</h2>
<p>Given the large number of features in our model, we also explored regularized logistic regression as a way to perform automatic feature selection and potentially improve generalization. In particular, we applied LASSO (L1) regularization and Ridge (L2) regularization to the logistic regression model using the glmnet package. Regularization adds a penalty term to the logistic model’s loss function that either constrains the sum of absolute coefficients (LASSO) or the sum of squared coefficients (Ridge), which can shrink less important coefficients towards zero. LASSO, in particular, can force some coefficients to become exactly zero, effectively removing those variables from the model – this is useful for feature selection and simplifying the model. We used 10-fold cross-validation on the training set to choose the optimal regularization strength (the tuning parameter <span class="math inline">\(\lambda\)</span>) for both LASSO and ridge. For each type of penalty, glmnet provides a sequence of models for various <span class="math inline">\(\lambda\)</span> values, and we picked the value of <span class="math inline">\(\lambda\)</span> that maximized the cross-validated AUC (or minimized deviance).</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="final_project_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:50.0%"></p>
</figure>
</div>
</div>
</div>
<p>LASSO results: The optimal LASSO model had a relatively small penalty. The LASSO ended up setting 2 of the 27 coefficients to zero. Specifically, it effectively dropped two of the six BILL_AMT features – those corresponding to the 4th and 5th month’s bill balances (i.e., BILL_AMT4 and BILL_AMT5). This makes sense because, as we saw, the bill amounts are highly correlated across months; apparently BILL_AMT4 and BILL_AMT5 were the most redundant given the others. The LASSO kept all other variables, including all six PAY_status variables (PAY_0 through PAY_6 remained in the model), all six payment amount features, the first three and the sixth bill amount, the credit limit, age, sex, education, etc. In other words, LASSO eliminated only those two bill amount features and retained 25 features.</p>
<p>In terms of performance, the LASSO model did just as well as the full logistic model. It had the same AUC (about 0.72) and same accuracy (about 81.2%) on the test set. Recall and precision were also nearly the same (about 25% recall, 72% precision). This means BILL_AMT4 and BILL_AMT5 didn’t add any value to prediction, and removing them made the model simpler without hurting performance.</p>
<p>This is a good outcome—it makes the model easier to understand and possibly more stable by reducing overlap between similar features. It also confirms that the PAY_n variables and recent bill/payment amounts are the most useful, while LASSO helped confirm that two middle-month bills were not needed.</p>
<p>Unlike LASSO, Ridge regression doesn’t remove features—it just shrinks the coefficients, especially for less important ones. In our case, the ridge-penalized logistic model kept all features, but with smaller weights for the less useful variables. Its performance was also about the same as the standard logistic model, with an AUC around 0.72.</p>
<p>Ridge can be helpful when features are highly correlated because it spreads the influence across them more evenly. This can make the model more stable. Since our main goal is prediction—not interpreting exact coefficients—ridge didn’t bring major gains, but it confirmed that multicollinearity wasn’t a big problem.</p>
<p>Conclusion on Regularization: LASSO gave us a simpler version of the logistic model by removing two redundant features (BILL_AMT4 and BILL_AMT5) without hurting performance. The LASSO model had the same test accuracy (~81.2%), AUC (~0.72), recall (~25%), and precision (~72%) as the full logistic model. This is exactly what we want from regularization: a model that’s simpler, easier to deploy, and just as effective.</p>
<p>However, even after regularization, the logistic models still performed worse than the ensemble methods, especially in recall. This shows that no linear model—regularized or not—could fully capture the complex patterns that methods like Random Forest or XGBoost could. But LASSO did help clean up redundancy and improved the model’s usability.</p>
</section>
<section id="model-comparison" class="level2">
<h2 class="anchored" data-anchor-id="model-comparison">10 Model Comparison</h2>
<p>We trained a wide variety of models to predict credit card defaults, including logistic regression, a decision tree, Random Forest, XGBoost, SVM, and a neural network. Now, we compare how each model performed on the test set to see which one worked best. Table 19 below summarizes the key performance metrics for each model on the test set: overall accuracy, ROC AUC, recall (sensitivity) for the default class, and precision (positive predictive value) for the default class.</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Table 19 Model comparison on the 20% test set: accuracy, ROC AUC, and default‐class recall &amp; precision.</caption>
<colgroup>
<col style="width: 25%">
<col style="width: 10%">
<col style="width: 9%">
<col style="width: 30%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Model</th>
<th style="text-align: center;">Accuracy</th>
<th style="text-align: center;">ROC AUC</th>
<th style="text-align: center;">Default Recall (Sensitivity)</th>
<th style="text-align: center;">Default Precision (PPV)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Logistic Regression</td>
<td style="text-align: center;">81.2%</td>
<td style="text-align: center;">0.72</td>
<td style="text-align: center;">25%</td>
<td style="text-align: center;">72%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Decision Tree (CART)</td>
<td style="text-align: center;">82.0%</td>
<td style="text-align: center;">0.65</td>
<td style="text-align: center;">32%</td>
<td style="text-align: center;">71%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Random Forest</td>
<td style="text-align: center;">82.0%</td>
<td style="text-align: center;">0.76</td>
<td style="text-align: center;">37%</td>
<td style="text-align: center;">66%</td>
</tr>
<tr class="even">
<td style="text-align: left;">XGBoost</td>
<td style="text-align: center;">81.4%</td>
<td style="text-align: center;">0.76</td>
<td style="text-align: center;">36%</td>
<td style="text-align: center;">64%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SVM (RBF Kernel)</td>
<td style="text-align: center;">82.0%</td>
<td style="text-align: center;">0.72</td>
<td style="text-align: center;">32%</td>
<td style="text-align: center;">71%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Neural Network (1 layer)</td>
<td style="text-align: center;">81.9%</td>
<td style="text-align: center;">0.77</td>
<td style="text-align: center;">38%</td>
<td style="text-align: center;">66%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">LASSO–Logistic</td>
<td style="text-align: center;">81.2%</td>
<td style="text-align: center;">0.72</td>
<td style="text-align: center;">25%</td>
<td style="text-align: center;">72%</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>We tested a wide range of models for predicting credit card defaults. Table 19 compares their performance side by side on the test set. Here are the key takeaways:</p>
<ul>
<li><p>Baseline Logistic vs.&nbsp;Others: The logistic regression model had solid overall accuracy at 81.2%. But it struggled to detect defaulters. Its recall was only 25%, meaning it missed most default cases. It mainly predicted “No default,” the majority class. That’s why its precision was relatively high at 72%—it only flagged the most obvious defaulters. The model’s AUC was 0.72, which is fair but leaves room for improvement. Overall, it served as a decent baseline, but not much more.</p></li>
<li><p>Single Decision Tree: The decision tree (CART) raised recall to 32%, improving over the logistic model. This shows that nonlinear splits helped it catch more defaulters. However, its AUC dropped to 0.65, the lowest among all models. That means it wasn’t good at ranking overall risk. The tree may have overfit some patterns, which hurt its generalization. Precision stayed around 71%, close to the logistic model. In short, the tree caught more defaulters but did a worse job ranking them. A single tree was too simple for this complex problem.</p></li>
<li><p>Ensemble Trees (Random Forest &amp; XGBoost): Random Forest and XGBoost gave the most balanced performance. Both reached an AUC of about 0.76—the highest, along with the neural net. Random Forest recalled 38% of defaulters, while XGBoost recalled 36%. Precision was around 66% for Random Forest and 64% for XGBoost. Their overall accuracy was also strong, about 81–82%. Between them, Random Forest was slightly better at catching defaulters. XGBoost had slightly fewer false positives. Both models performed far better than logistic regression. They found about 1.5 times more defaulters, with only a small cost in precision. This shows that ensemble trees are excellent for handling imbalanced data.</p></li>
<li><p>SVM and Neural Network: SVM and the neural network also performed well. SVM reached an AUC of 0.72, with 32% recall and 71% precision—very similar to the decision tree. That’s interesting, since SVM is a very different model type. The neural network had the highest AUC at around 0.77. It achieved 38% recall and 66% precision, almost matching Random Forest. This shows that both nonlinear methods—SVM and neural nets—can work well for this task. The neural network stood out slightly more due to its strong AUC. It caught as many defaulters as Random Forest and ranked them slightly better.</p></li>
<li><p>LASSO-Regularized Logistic: LASSO gave the same results as standard logistic regression. Accuracy was 81.2%, AUC 0.72, recall 25%, and precision 72%. It removed a few unhelpful features but didn’t boost performance. The result was a simpler model, but still not a strong one. It showed that even the best linear combination of features can’t match nonlinear models like Random Forest, XGBoost, or neural nets.</p></li>
</ul>
<p>From these results, Random Forest and XGBoost were the best overall. They had the highest AUC scores and much better recall than simpler models. Random Forest had slightly higher recall, making it a better choice for catching more defaulters. XGBoost had slightly better precision, which helps reduce false alarms. Either would be a strong pick.</p>
<p>Neural networks also performed very well. Our basic neural net matched Random Forest, which is impressive. With more tuning, it could do even better. But since tree models are easier to interpret and tune, Random Forest and XGBoost are likely more practical for most use cases.</p>
<p>The logistic model, while simple and interpretable, missed too many defaulters. It works as a baseline but lacks the power needed for real-world credit risk. The single decision tree was also easy to understand but didn’t perform as well as the more advanced models.</p>
</section>
<section id="model-interpretation" class="level2">
<h2 class="anchored" data-anchor-id="model-interpretation">11 Model Interpretation</h2>
<p>While the complex models performed best, we still want to interpret what drives default risk. Consistently across models, the recent payment-status indicators (PAY_0–PAY_6) were the most important feature. To illustrate, Table 20 below summarizes the direction of influence of key predictors according to logistic coefficients.</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Table 20: Predictor effects on default risk. Positive (+) means higher values increase default risk; negative (–) means higher values decrease risk.</caption>
<colgroup>
<col style="width: 38%">
<col style="width: 62%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Predictor</th>
<th style="text-align: left;">Effect on Default Risk</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Repayment status PAY_0–PAY_6</td>
<td style="text-align: left;"><strong>Positive</strong> (+): recent late payments greatly increase risk</td>
</tr>
<tr class="even">
<td style="text-align: left;">Credit limit (LIMIT_BAL)</td>
<td style="text-align: left;"><strong>Negative</strong> (–): higher limit slightly lowers risk</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Education level</td>
<td style="text-align: left;"><strong>Negative</strong> (–): higher education associated with lower risk</td>
</tr>
<tr class="even">
<td style="text-align: left;">Marital status (Married vs Single)</td>
<td style="text-align: left;"><strong>Negative</strong> (–): being married has a minor protective effect</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Age</td>
<td style="text-align: left;"><strong>Negative</strong> (–): older age slightly reduces risk</td>
</tr>
<tr class="even">
<td style="text-align: left;">Bill/Pymt amounts (BILL_AMT, PAY_AMT)</td>
<td style="text-align: left;">Mixed/Neutral: little net effect once payment status is known</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>As the table shows, any indication of recent delinquency (higher PAY values) sharply raises default odds. In contrast, having a higher credit limit, higher education, or being married lowers the predicted risk a bit. These signs are consistent with our analysis above. Overall, recent payment behavior dominates the risk model.</p>
</section>
<section id="illustrative-example" class="level2">
<h2 class="anchored" data-anchor-id="illustrative-example">12 Illustrative Example</h2>
<p>As an example, consider a hypothetical customer with the following profile:</p>
<ul>
<li><strong>Age</strong>: 30<br>
</li>
<li><strong>Gender</strong>: Male<br>
</li>
<li><strong>Education</strong>: University graduate<br>
</li>
<li><strong>Marital status</strong>: Single<br>
</li>
<li><strong>Credit limit</strong>: NT$50,000<br>
</li>
<li><strong>Repayment status</strong>: On-time payment for months 1–6 (<code>PAY_2</code> through <code>PAY_6</code> = 0), but 1 month late in the most recent month (<code>PAY_0</code> = 1).<br>
</li>
<li><strong>Bill amounts and payment amounts</strong>: Average values.</li>
</ul>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Credit line decision for this customer: Approve </code></pre>
</div>
</div>
<p>Plugging these into our logistic regression model yields an estimated default probability of about 34.6%. Using a cutoff of 50%, the model would predict no default for this client (because 0.346 &lt; 0.50). In practical terms, the model views this customer as a low-to-moderate risk. Therefore, the recommendation would be to approve the credit line. The low predicted risk reflects that the client has an on-time history except one recent delay and a modest credit limit. If the customer had more or larger late payments, the probability would rise and might trigger a “reject” recommendation.</p>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>In this project, we used several machine learning methods to predict next-month credit card default. We worked with the UCI dataset of Taiwanese credit card clients. The methods included logistic regression, regularized models like LASSO, decision trees, ensemble learners (Random Forest and XGBoost), kernel-based methods, and neural networks. Our goal was to compare these models and find the best one for both prediction and understanding default risk.</p>
<p>Model Performance Summary: Table 19 and the earlier discussion summarize the results. The ensemble tree models performed best. Random Forest had the strongest overall metrics. It reached 81.8% accuracy, 0.76 AUC, 38% recall, and 66% precision on the test set.</p>
<p>XGBoost and the one-layer neural network gave similar results. Their AUCs were around 0.76–0.77. Their recall was between 36–38%, and precision was about 64–66%.</p>
<p>Simpler models didn’t perform as well. Logistic regression had 81.2% accuracy, 0.72 AUC, and just 25% recall. The pruned decision tree had slightly higher accuracy (82.0%) but a lower AUC (0.65) and 32% recall. These models missed many defaulters. Even though their accuracy was decent, the low recall makes them less useful in practice.</p>
<p>LASSO performed like logistic regression (same accuracy and AUC, same 25% recall), but used fewer features. This means we can simplify the model without losing accuracy, though we won’t gain much either.</p>
<p>Key Drivers of Default Risk: All the advanced models pointed to the same key insight: recent payment behavior is the top predictor of default. Variables like PAY_0 to PAY_6—especially PAY_0—were always ranked most important. If a customer recently missed a payment, their risk of default increased sharply. This pattern showed up in every model. In the logistic model, the odds of default rose steeply for each delay. In the tree-based models and neural net, the same variables drove most of the splits and weights. Bill amounts also mattered, especially the most recent ones (like BILL_AMT1 and BILL_AMT2). High balances meant higher risk. But demographic factors such as age, gender, education, and marriage had little impact. They had small coefficients in logistic regression and low importance in tree models. LASSO confirmed this by shrinking many demographic and bill amount coefficients close to zero. It even dropped BILL_AMT4 and BILL_AMT5 entirely, which suggests those variables added little beyond the others. This supports the idea that behavior, not background, is what truly drives credit risk.</p>
<p>Recommended Model and Use: For a real-world credit system, Random Forest stands out as a strong choice. It offers higher recall than logistic regression, catching more defaulters. This is useful if the goal is early intervention. For example, it found 38% of defaulters, compared to only 25% with logistic regression. That’s about 50% more, which could reduce financial losses if those customers are flagged in time. If avoiding false positives is more important, XGBoost is also a good option. It had slightly better precision and very similar recall. In practice, the two models could work together. For instance, the bank might flag customers only if both models agree, or use XGBoost to recheck Random Forest predictions. Both models are far better than the logistic baseline. They show that nonlinear ensemble methods work best for this dataset.</p>
<p>Limitations and Future Work:</p>
<ul>
<li>Dataset Limitations: The data is from 2005 and limited to one country. Behavior may differ today or in other regions. Any deployed model should be retrained for a new context.</li>
<li>Evaluation Metrics: We used general metrics like accuracy and AUC. But in practice, false positives and false negatives have different costs. A better approach would include cost-sensitive training or custom thresholds.</li>
<li>Limited Tuning: Our model tuning was basic. More advanced methods, such as Bayesian optimization or deeper architectures, might boost performance further.</li>
<li>Feature Set: We only used the provided variables. Banks could add credit scores, economic data, or longer payment histories. Time-series modeling could also help.</li>
<li>One-Shot Evaluation: We evaluated our models once. In practice, models should be monitored and recalibrated over time. We also didn’t analyze profit impact. Future work could measure how better predictions affect revenue and cost.</li>
<li>Interpretability: While ensemble and neural models are harder to interpret, we used variable importance and trends to check their behavior. For real deployment, tools like SHAP or LIME could help explain model decisions.</li>
</ul>
<p>In sum, we tested seven models and validated their performance on a test set. Random Forest and XGBoost stood out for their ability to detect defaulters. LASSO helped simplify models, and clustering added extra value for customer segmentation.</p>
<p>Together, these tools show how machine learning can support smarter credit risk decisions. With further tuning and the use of additional data, these models could become powerful, real-world systems for managing credit portfolios.</p>
<div style="page-break-after: always;"></div>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
<p>Yeh, I.-C., &amp; Lien, C.-H. (2009). <em>Default of credit card clients dataset</em> [Data set]. UCI Machine Learning Repository. https://doi.org/10.24432/C55S3H.</p>
<div style="page-break-after: always;"></div>
</section>
<section id="code-appendix" class="level2">
<h2 class="anchored" data-anchor-id="code-appendix">Code Appendix</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom) </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pROC)       <span class="co"># for ROC curves</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart.plot)</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(randomForest)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(e1071)</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nnet)</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glmnet)</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corrplot)</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggcorrplot)</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cowplot)</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>raw_df <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"~/Desktop/Stat 380/UCI_Credit_Card.csv"</span>)</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> raw_df <span class="sc">%&gt;%</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">default_raw =</span> <span class="st">`</span><span class="at">default.payment.next.month</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">EDUCATION =</span> <span class="fu">ifelse</span>(EDUCATION <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">5</span>,<span class="dv">6</span>), <span class="dv">4</span>, EDUCATION),</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">MARRIAGE  =</span> <span class="fu">ifelse</span>(MARRIAGE <span class="sc">==</span> <span class="dv">0</span>, <span class="dv">3</span>, MARRIAGE),</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">SEX       =</span> <span class="fu">factor</span>(SEX, <span class="at">levels=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"Male"</span>,<span class="st">"Female"</span>)),</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">EDUCATION =</span> <span class="fu">factor</span>(EDUCATION,</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>                       <span class="at">levels=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>),</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>                       <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"Graduate School"</span>,<span class="st">"University"</span>,<span class="st">"High School"</span>,<span class="st">"Others"</span>)),</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">MARRIAGE  =</span> <span class="fu">factor</span>(MARRIAGE,</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>                       <span class="at">levels=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>),</span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>                       <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"Married"</span>,<span class="st">"Single"</span>,<span class="st">"Others"</span>)),</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">default   =</span> <span class="fu">factor</span>(default_raw,</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>                       <span class="at">levels=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>                       <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"No"</span>,<span class="st">"Yes"</span>))</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>ID, <span class="sc">-</span>default_raw)   <span class="co"># &lt;— explicitly from dplyr</span></span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 1: Variable descriptions</span></span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>var_desc <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>Variable,      <span class="sc">~</span>Type,          <span class="sc">~</span>Description,</span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Limit_BAL"</span>,    <span class="st">"Numeric"</span>,      <span class="st">"Amount of given credit (NT dollar)"</span>,</span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SEX"</span>,          <span class="st">"Factor"</span>,       <span class="st">"Gender (Male, Female)"</span>,</span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>  <span class="st">"EDUCATION"</span>,    <span class="st">"Factor"</span>,       <span class="st">"Education level (Graduate School, University, High School, Others)"</span>,</span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>  <span class="st">"MARRIAGE"</span>,     <span class="st">"Factor"</span>,       <span class="st">"Marital status (Married, Single, Others)"</span>,</span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>  <span class="st">"AGE"</span>,          <span class="st">"Numeric"</span>,      <span class="st">"Age in years"</span>,</span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>  <span class="st">"PAY_0 … PAY_6"</span>,<span class="st">"Ordinal"</span>,      <span class="st">"Repayment status Sept 2005 to Apr 2005 (−1=on time; 1=1 month delay; … 9=≥9 months delay)"</span>,</span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BILL_AMT1–6"</span>,  <span class="st">"Numeric"</span>,      <span class="st">"Bill statement amount (NT dollar) Sept 2005 to Apr 2005"</span>,</span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>  <span class="st">"PAY_AMT1–6"</span>,   <span class="st">"Numeric"</span>,      <span class="st">"Previous payment amount (NT dollar) Sept 2005 to Apr 2005"</span>,</span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>  <span class="st">"default"</span>,      <span class="st">"Factor"</span>,       <span class="st">"Default next month (Yes, No)"</span></span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a>  var_desc,</span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Table 1</span><span class="sc">\n</span><span class="st">Variable descriptions for the Default of Credit Card Clients dataset"</span>,</span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a>  <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a>  <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"l"</span>,<span class="st">"l"</span>,<span class="st">"l"</span>)</span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(</span>
<span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">latex_options =</span> <span class="fu">c</span>(<span class="st">"hold_position"</span>, <span class="st">"scale_down"</span>),</span>
<span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">font_size     =</span> <span class="dv">7</span></span>
<span id="cb5-64"><a href="#cb5-64" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-65"><a href="#cb5-65" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 2: Cleaned data overview</span></span>
<span id="cb5-66"><a href="#cb5-66" aria-hidden="true" tabindex="-1"></a>overview <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb5-67"><a href="#cb5-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb5-68"><a href="#cb5-68" aria-hidden="true" tabindex="-1"></a>    <span class="at">N =</span> <span class="fu">n</span>(),</span>
<span id="cb5-69"><a href="#cb5-69" aria-hidden="true" tabindex="-1"></a>    <span class="at">Male      =</span> <span class="fu">sum</span>(SEX<span class="sc">==</span><span class="st">"Male"</span>),</span>
<span id="cb5-70"><a href="#cb5-70" aria-hidden="true" tabindex="-1"></a>    <span class="at">Female    =</span> <span class="fu">sum</span>(SEX<span class="sc">==</span><span class="st">"Female"</span>),</span>
<span id="cb5-71"><a href="#cb5-71" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Mean age</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">mean</span>(AGE),</span>
<span id="cb5-72"><a href="#cb5-72" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Median Limit_BAL</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">median</span>(LIMIT_BAL),</span>
<span id="cb5-73"><a href="#cb5-73" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Mean Limit_BAL</span><span class="st">`</span>   <span class="ot">=</span> <span class="fu">mean</span>(LIMIT_BAL),</span>
<span id="cb5-74"><a href="#cb5-74" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Default Count</span><span class="st">`</span>    <span class="ot">=</span> <span class="fu">sum</span>(default<span class="sc">==</span><span class="st">"Yes"</span>),</span>
<span id="cb5-75"><a href="#cb5-75" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Default Rate (%)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">round</span>(<span class="dv">100</span> <span class="sc">*</span> <span class="fu">mean</span>(default<span class="sc">==</span><span class="st">"Yes"</span>), <span class="dv">1</span>)</span>
<span id="cb5-76"><a href="#cb5-76" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb5-77"><a href="#cb5-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to=</span><span class="st">"Statistic"</span>, <span class="at">values_to=</span><span class="st">"Value"</span>)</span>
<span id="cb5-78"><a href="#cb5-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-79"><a href="#cb5-79" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb5-80"><a href="#cb5-80" aria-hidden="true" tabindex="-1"></a>  overview,</span>
<span id="cb5-81"><a href="#cb5-81" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Table 2</span><span class="sc">\n</span><span class="st">Summary statistics of the cleaned dataset (N = 30,000)"</span>,</span>
<span id="cb5-82"><a href="#cb5-82" aria-hidden="true" tabindex="-1"></a>  <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb5-83"><a href="#cb5-83" aria-hidden="true" tabindex="-1"></a>  <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"l"</span>,<span class="st">"r"</span>)</span>
<span id="cb5-84"><a href="#cb5-84" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb5-85"><a href="#cb5-85" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(</span>
<span id="cb5-86"><a href="#cb5-86" aria-hidden="true" tabindex="-1"></a>    <span class="at">latex_options =</span> <span class="fu">c</span>(<span class="st">"hold_position"</span>, <span class="st">"scale_down"</span>),</span>
<span id="cb5-87"><a href="#cb5-87" aria-hidden="true" tabindex="-1"></a>    <span class="at">font_size     =</span> <span class="dv">7</span></span>
<span id="cb5-88"><a href="#cb5-88" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-89"><a href="#cb5-89" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 3: Default rate by demographic factor</span></span>
<span id="cb5-90"><a href="#cb5-90" aria-hidden="true" tabindex="-1"></a>eda_cat <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb5-91"><a href="#cb5-91" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb5-92"><a href="#cb5-92" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(SEX) <span class="sc">%&gt;%</span></span>
<span id="cb5-93"><a href="#cb5-93" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">Count =</span> <span class="fu">n</span>(),</span>
<span id="cb5-94"><a href="#cb5-94" aria-hidden="true" tabindex="-1"></a>              <span class="st">`</span><span class="at">Default Rate (%)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">round</span>(<span class="fu">mean</span>(default<span class="sc">==</span><span class="st">"Yes"</span>)<span class="sc">*</span><span class="dv">100</span>,<span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb5-95"><a href="#cb5-95" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Factor =</span> <span class="st">"Gender"</span>, <span class="at">Level =</span> SEX) <span class="sc">%&gt;%</span></span>
<span id="cb5-96"><a href="#cb5-96" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(Factor, Level, Count, <span class="st">`</span><span class="at">Default Rate (%)</span><span class="st">`</span>),</span>
<span id="cb5-97"><a href="#cb5-97" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-98"><a href="#cb5-98" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb5-99"><a href="#cb5-99" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(EDUCATION) <span class="sc">%&gt;%</span></span>
<span id="cb5-100"><a href="#cb5-100" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">Count =</span> <span class="fu">n</span>(),</span>
<span id="cb5-101"><a href="#cb5-101" aria-hidden="true" tabindex="-1"></a>              <span class="st">`</span><span class="at">Default Rate (%)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">round</span>(<span class="fu">mean</span>(default<span class="sc">==</span><span class="st">"Yes"</span>)<span class="sc">*</span><span class="dv">100</span>,<span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb5-102"><a href="#cb5-102" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Factor =</span> <span class="st">"Education"</span>, <span class="at">Level =</span> EDUCATION) <span class="sc">%&gt;%</span></span>
<span id="cb5-103"><a href="#cb5-103" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(Factor, Level, Count, <span class="st">`</span><span class="at">Default Rate (%)</span><span class="st">`</span>),</span>
<span id="cb5-104"><a href="#cb5-104" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-105"><a href="#cb5-105" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb5-106"><a href="#cb5-106" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(MARRIAGE) <span class="sc">%&gt;%</span></span>
<span id="cb5-107"><a href="#cb5-107" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">Count =</span> <span class="fu">n</span>(),</span>
<span id="cb5-108"><a href="#cb5-108" aria-hidden="true" tabindex="-1"></a>              <span class="st">`</span><span class="at">Default Rate (%)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">round</span>(<span class="fu">mean</span>(default<span class="sc">==</span><span class="st">"Yes"</span>)<span class="sc">*</span><span class="dv">100</span>,<span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb5-109"><a href="#cb5-109" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Factor =</span> <span class="st">"Marital Status"</span>, <span class="at">Level =</span> MARRIAGE) <span class="sc">%&gt;%</span></span>
<span id="cb5-110"><a href="#cb5-110" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(Factor, Level, Count, <span class="st">`</span><span class="at">Default Rate (%)</span><span class="st">`</span>)</span>
<span id="cb5-111"><a href="#cb5-111" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-112"><a href="#cb5-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-113"><a href="#cb5-113" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(</span>
<span id="cb5-114"><a href="#cb5-114" aria-hidden="true" tabindex="-1"></a>  eda_cat,</span>
<span id="cb5-115"><a href="#cb5-115" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Table 3</span><span class="sc">\n</span><span class="st">Default rate by demographic factor"</span>,</span>
<span id="cb5-116"><a href="#cb5-116" aria-hidden="true" tabindex="-1"></a>  <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb5-117"><a href="#cb5-117" aria-hidden="true" tabindex="-1"></a>  <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"l"</span>,<span class="st">"l"</span>,<span class="st">"r"</span>,<span class="st">"r"</span>)</span>
<span id="cb5-118"><a href="#cb5-118" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-119"><a href="#cb5-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-120"><a href="#cb5-120" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 4: Mean age and limit by default status</span></span>
<span id="cb5-121"><a href="#cb5-121" aria-hidden="true" tabindex="-1"></a>eda_num <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb5-122"><a href="#cb5-122" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(default) <span class="sc">%&gt;%</span></span>
<span id="cb5-123"><a href="#cb5-123" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb5-124"><a href="#cb5-124" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Mean Age</span><span class="st">`</span>        <span class="ot">=</span> <span class="fu">round</span>(<span class="fu">mean</span>(AGE),<span class="dv">1</span>),</span>
<span id="cb5-125"><a href="#cb5-125" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Mean Limit_BAL</span><span class="st">`</span>  <span class="ot">=</span> <span class="fu">round</span>(<span class="fu">mean</span>(LIMIT_BAL),<span class="dv">0</span>),</span>
<span id="cb5-126"><a href="#cb5-126" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb5-127"><a href="#cb5-127" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb5-128"><a href="#cb5-128" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">`</span><span class="at">Default Status</span><span class="st">`</span> <span class="ot">=</span> default)</span>
<span id="cb5-129"><a href="#cb5-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-130"><a href="#cb5-130" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(</span>
<span id="cb5-131"><a href="#cb5-131" aria-hidden="true" tabindex="-1"></a>  eda_num,</span>
<span id="cb5-132"><a href="#cb5-132" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Table 4</span><span class="sc">\n</span><span class="st">Mean age and credit limit by default status"</span>,</span>
<span id="cb5-133"><a href="#cb5-133" aria-hidden="true" tabindex="-1"></a>  <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb5-134"><a href="#cb5-134" aria-hidden="true" tabindex="-1"></a>  <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"l"</span>,<span class="st">"r"</span>,<span class="st">"r"</span>)</span>
<span id="cb5-135"><a href="#cb5-135" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-136"><a href="#cb5-136" aria-hidden="true" tabindex="-1"></a>pay0_stats <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb5-137"><a href="#cb5-137" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(PAY_0) <span class="sc">%&gt;%</span></span>
<span id="cb5-138"><a href="#cb5-138" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">default_rate =</span> <span class="fu">mean</span>(default <span class="sc">==</span> <span class="st">"Yes"</span>), <span class="at">.groups=</span><span class="st">"drop"</span>)</span>
<span id="cb5-139"><a href="#cb5-139" aria-hidden="true" tabindex="-1"></a>num_vars <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb5-140"><a href="#cb5-140" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb5-141"><a href="#cb5-141" aria-hidden="true" tabindex="-1"></a>    LIMIT_BAL, </span>
<span id="cb5-142"><a href="#cb5-142" aria-hidden="true" tabindex="-1"></a>    AGE, </span>
<span id="cb5-143"><a href="#cb5-143" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">"BILL_AMT"</span>), </span>
<span id="cb5-144"><a href="#cb5-144" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">"PAY_AMT"</span>)</span>
<span id="cb5-145"><a href="#cb5-145" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-146"><a href="#cb5-146" aria-hidden="true" tabindex="-1"></a>corr_mat <span class="ot">&lt;-</span> <span class="fu">cor</span>(num_vars, <span class="at">use =</span> <span class="st">"pairwise.complete.obs"</span>)</span>
<span id="cb5-147"><a href="#cb5-147" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggcorrplot</span>(</span>
<span id="cb5-148"><a href="#cb5-148" aria-hidden="true" tabindex="-1"></a>  corr_mat,</span>
<span id="cb5-149"><a href="#cb5-149" aria-hidden="true" tabindex="-1"></a>  <span class="at">hc.order    =</span> <span class="cn">TRUE</span>,</span>
<span id="cb5-150"><a href="#cb5-150" aria-hidden="true" tabindex="-1"></a>  <span class="at">type        =</span> <span class="st">"lower"</span>,</span>
<span id="cb5-151"><a href="#cb5-151" aria-hidden="true" tabindex="-1"></a>  <span class="at">lab         =</span> <span class="cn">TRUE</span>,</span>
<span id="cb5-152"><a href="#cb5-152" aria-hidden="true" tabindex="-1"></a>  <span class="at">lab_size    =</span> <span class="dv">2</span>,</span>
<span id="cb5-153"><a href="#cb5-153" aria-hidden="true" tabindex="-1"></a>  <span class="at">title       =</span> <span class="st">"Figure 1: Correlation Heatmap of Financial Features"</span></span>
<span id="cb5-154"><a href="#cb5-154" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb5-155"><a href="#cb5-155" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb5-156"><a href="#cb5-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-157"><a href="#cb5-157" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb5-158"><a href="#cb5-158" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(PAY_0) <span class="sc">%&gt;%</span></span>
<span id="cb5-159"><a href="#cb5-159" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">default_rate =</span> <span class="fu">mean</span>(default <span class="sc">==</span> <span class="st">"Yes"</span>) <span class="sc">*</span> <span class="dv">100</span>, <span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb5-160"><a href="#cb5-160" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(PAY_0), <span class="at">y =</span> default_rate)) <span class="sc">+</span></span>
<span id="cb5-161"><a href="#cb5-161" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"#feb24c"</span>) <span class="sc">+</span></span>
<span id="cb5-162"><a href="#cb5-162" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">sprintf</span>(<span class="st">"%.1f%%"</span>, default_rate)), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb5-163"><a href="#cb5-163" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb5-164"><a href="#cb5-164" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Figure 2: Default Rate vs. Most Recent Payment Status (PAY_0)"</span>,</span>
<span id="cb5-165"><a href="#cb5-165" aria-hidden="true" tabindex="-1"></a>      <span class="at">x     =</span> <span class="st">"PAY_0 (−1 = on time; 1 = 1 month delay; …)"</span>,</span>
<span id="cb5-166"><a href="#cb5-166" aria-hidden="true" tabindex="-1"></a>      <span class="at">y     =</span> <span class="st">"Default Rate (%)"</span></span>
<span id="cb5-167"><a href="#cb5-167" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb5-168"><a href="#cb5-168" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb5-169"><a href="#cb5-169" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb5-170"><a href="#cb5-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-171"><a href="#cb5-171" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span> </span>
<span id="cb5-172"><a href="#cb5-172" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">widths =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>)) <span class="sc">&amp;</span></span>
<span id="cb5-173"><a href="#cb5-173" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb5-174"><a href="#cb5-174" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.margin =</span> ggplot2<span class="sc">::</span><span class="fu">margin</span>(<span class="at">t =</span> <span class="dv">10</span>, <span class="at">r =</span> <span class="dv">10</span>, <span class="at">b =</span> <span class="dv">10</span>, <span class="at">l =</span> <span class="dv">10</span>, <span class="at">unit =</span> <span class="st">"pt"</span>)</span>
<span id="cb5-175"><a href="#cb5-175" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-176"><a href="#cb5-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-177"><a href="#cb5-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-178"><a href="#cb5-178" aria-hidden="true" tabindex="-1"></a><span class="co"># compute bill/pay summary and correlation values</span></span>
<span id="cb5-179"><a href="#cb5-179" aria-hidden="true" tabindex="-1"></a>bill_cols       <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">"^BILL_AMT[1-6]$"</span>, <span class="fu">names</span>(df), <span class="at">value=</span><span class="cn">TRUE</span>)</span>
<span id="cb5-180"><a href="#cb5-180" aria-hidden="true" tabindex="-1"></a>pay_cols        <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">"^PAY_AMT[1-6]$"</span>,  <span class="fu">names</span>(df), <span class="at">value=</span><span class="cn">TRUE</span>)</span>
<span id="cb5-181"><a href="#cb5-181" aria-hidden="true" tabindex="-1"></a>bill_corr_vals  <span class="ot">&lt;-</span> <span class="fu">cor</span>(df[bill_cols], <span class="at">use=</span><span class="st">"complete.obs"</span>)[<span class="fu">lower.tri</span>(<span class="fu">diag</span>(<span class="dv">6</span>))]</span>
<span id="cb5-182"><a href="#cb5-182" aria-hidden="true" tabindex="-1"></a>pay_corr_vals   <span class="ot">&lt;-</span> <span class="fu">cor</span>(df[pay_cols],  <span class="at">use=</span><span class="st">"complete.obs"</span>)[<span class="fu">lower.tri</span>(<span class="fu">diag</span>(<span class="dv">6</span>))]</span>
<span id="cb5-183"><a href="#cb5-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-184"><a href="#cb5-184" aria-hidden="true" tabindex="-1"></a>bill_range <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">range</span>(bill_corr_vals), <span class="dv">2</span>)</span>
<span id="cb5-185"><a href="#cb5-185" aria-hidden="true" tabindex="-1"></a>pay_mean   <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">mean</span>(pay_corr_vals), <span class="dv">2</span>)</span>
<span id="cb5-186"><a href="#cb5-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-187"><a href="#cb5-187" aria-hidden="true" tabindex="-1"></a><span class="co"># Print correlation summary</span></span>
<span id="cb5-188"><a href="#cb5-188" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Bill‐statement correlations: r ="</span>, bill_range[<span class="dv">1</span>], <span class="st">"to"</span>, bill_range[<span class="dv">2</span>], <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb5-189"><a href="#cb5-189" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Mean payment‐amount correlation: r ="</span>, pay_mean, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb5-190"><a href="#cb5-190" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> BILL_AMT1, <span class="at">y =</span> PAY_AMT1, <span class="at">color =</span> default)) <span class="sc">+</span></span>
<span id="cb5-191"><a href="#cb5-191" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb5-192"><a href="#cb5-192" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>comma) <span class="sc">+</span></span>
<span id="cb5-193"><a href="#cb5-193" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>comma) <span class="sc">+</span></span>
<span id="cb5-194"><a href="#cb5-194" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Figure 3: Payment vs. Bill Amount (Month 1)"</span>,</span>
<span id="cb5-195"><a href="#cb5-195" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"BILL_AMT1 (NTD)"</span>,</span>
<span id="cb5-196"><a href="#cb5-196" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"PAY_AMT1 (NTD)"</span>,</span>
<span id="cb5-197"><a href="#cb5-197" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Default"</span>) <span class="sc">+</span></span>
<span id="cb5-198"><a href="#cb5-198" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb5-199"><a href="#cb5-199" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb5-200"><a href="#cb5-200" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb5-201"><a href="#cb5-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-202"><a href="#cb5-202" aria-hidden="true" tabindex="-1"></a><span class="co"># build a tiny summary tibble</span></span>
<span id="cb5-203"><a href="#cb5-203" aria-hidden="true" tabindex="-1"></a>corr_summary <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb5-204"><a href="#cb5-204" aria-hidden="true" tabindex="-1"></a>  <span class="at">Feature =</span> <span class="fu">c</span>(<span class="st">"Bill-statement correlations"</span>, <span class="st">"Mean payment-amount correlation"</span>),</span>
<span id="cb5-205"><a href="#cb5-205" aria-hidden="true" tabindex="-1"></a>  <span class="at">Correlation =</span> <span class="fu">c</span>(<span class="st">"0.80 – 0.95"</span>, <span class="st">"0.19"</span>)</span>
<span id="cb5-206"><a href="#cb5-206" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-207"><a href="#cb5-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-208"><a href="#cb5-208" aria-hidden="true" tabindex="-1"></a>corr_summary <span class="sc">%&gt;%</span></span>
<span id="cb5-209"><a href="#cb5-209" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(</span>
<span id="cb5-210"><a href="#cb5-210" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Table 5</span><span class="sc">\n</span><span class="st">Summary of Key Correlations"</span>,</span>
<span id="cb5-211"><a href="#cb5-211" aria-hidden="true" tabindex="-1"></a>    <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Feature"</span>, <span class="st">"Pearson r"</span>),</span>
<span id="cb5-212"><a href="#cb5-212" aria-hidden="true" tabindex="-1"></a>    <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"l"</span>,<span class="st">"c"</span>)</span>
<span id="cb5-213"><a href="#cb5-213" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-214"><a href="#cb5-214" aria-hidden="true" tabindex="-1"></a><span class="co"># Linear regression: predict credit limit from demographics</span></span>
<span id="cb5-215"><a href="#cb5-215" aria-hidden="true" tabindex="-1"></a>lm_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(LIMIT_BAL <span class="sc">~</span> AGE <span class="sc">+</span> SEX <span class="sc">+</span> EDUCATION <span class="sc">+</span> MARRIAGE, <span class="at">data =</span> df)</span>
<span id="cb5-216"><a href="#cb5-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-217"><a href="#cb5-217" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm_model)</span>
<span id="cb5-218"><a href="#cb5-218" aria-hidden="true" tabindex="-1"></a>coef_tbl <span class="ot">&lt;-</span> lm_model <span class="sc">%&gt;%</span></span>
<span id="cb5-219"><a href="#cb5-219" aria-hidden="true" tabindex="-1"></a>  broom<span class="sc">::</span><span class="fu">tidy</span>() <span class="sc">%&gt;%</span></span>
<span id="cb5-220"><a href="#cb5-220" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb5-221"><a href="#cb5-221" aria-hidden="true" tabindex="-1"></a>    <span class="at">term =</span> <span class="fu">recode</span>(term,</span>
<span id="cb5-222"><a href="#cb5-222" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">(Intercept)</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"Intercept"</span>,</span>
<span id="cb5-223"><a href="#cb5-223" aria-hidden="true" tabindex="-1"></a>      <span class="at">AGE           =</span> <span class="st">"Age (years)"</span>,</span>
<span id="cb5-224"><a href="#cb5-224" aria-hidden="true" tabindex="-1"></a>      <span class="at">SEXFemale     =</span> <span class="st">"Female (vs Male)"</span>,</span>
<span id="cb5-225"><a href="#cb5-225" aria-hidden="true" tabindex="-1"></a>      <span class="at">EDUCATIONUniversity  =</span> <span class="st">"Univ (vs Grad)"</span>,</span>
<span id="cb5-226"><a href="#cb5-226" aria-hidden="true" tabindex="-1"></a>      <span class="at">EDUCATIONHighSchool =</span> <span class="st">"High School (vs Grad)"</span>,</span>
<span id="cb5-227"><a href="#cb5-227" aria-hidden="true" tabindex="-1"></a>      <span class="at">EDUCATIONOthers      =</span> <span class="st">"Others (vs Grad)"</span>,</span>
<span id="cb5-228"><a href="#cb5-228" aria-hidden="true" tabindex="-1"></a>      <span class="at">MARRIAGESingle       =</span> <span class="st">"Single (vs Married)"</span>,</span>
<span id="cb5-229"><a href="#cb5-229" aria-hidden="true" tabindex="-1"></a>      <span class="at">MARRIAGEOthers       =</span> <span class="st">"Other Marital Status"</span></span>
<span id="cb5-230"><a href="#cb5-230" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb5-231"><a href="#cb5-231" aria-hidden="true" tabindex="-1"></a>    <span class="at">p.value =</span> <span class="fu">signif</span>(p.value, <span class="dv">3</span>),</span>
<span id="cb5-232"><a href="#cb5-232" aria-hidden="true" tabindex="-1"></a>    <span class="at">sig =</span> <span class="fu">case_when</span>(</span>
<span id="cb5-233"><a href="#cb5-233" aria-hidden="true" tabindex="-1"></a>      p.value <span class="sc">&lt;</span> <span class="fl">0.001</span> <span class="sc">~</span> <span class="st">"***"</span>,</span>
<span id="cb5-234"><a href="#cb5-234" aria-hidden="true" tabindex="-1"></a>      p.value <span class="sc">&lt;</span> <span class="fl">0.01</span>  <span class="sc">~</span> <span class="st">"**"</span>,</span>
<span id="cb5-235"><a href="#cb5-235" aria-hidden="true" tabindex="-1"></a>      p.value <span class="sc">&lt;</span> <span class="fl">0.05</span>  <span class="sc">~</span> <span class="st">"*"</span>,</span>
<span id="cb5-236"><a href="#cb5-236" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span>            <span class="sc">~</span> <span class="st">""</span></span>
<span id="cb5-237"><a href="#cb5-237" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-238"><a href="#cb5-238" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb5-239"><a href="#cb5-239" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb5-240"><a href="#cb5-240" aria-hidden="true" tabindex="-1"></a>    <span class="at">Term      =</span> term,</span>
<span id="cb5-241"><a href="#cb5-241" aria-hidden="true" tabindex="-1"></a>    <span class="at">Estimate  =</span> estimate,</span>
<span id="cb5-242"><a href="#cb5-242" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Std. Error</span><span class="st">`</span> <span class="ot">=</span> std.error,</span>
<span id="cb5-243"><a href="#cb5-243" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">t value</span><span class="st">`</span> <span class="ot">=</span> statistic,</span>
<span id="cb5-244"><a href="#cb5-244" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Pr(&gt;|t|)</span><span class="st">`</span> <span class="ot">=</span> p.value,</span>
<span id="cb5-245"><a href="#cb5-245" aria-hidden="true" tabindex="-1"></a>    <span class="at">Sig =</span> sig</span>
<span id="cb5-246"><a href="#cb5-246" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-247"><a href="#cb5-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-248"><a href="#cb5-248" aria-hidden="true" tabindex="-1"></a>coef_tbl <span class="sc">%&gt;%</span></span>
<span id="cb5-249"><a href="#cb5-249" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(</span>
<span id="cb5-250"><a href="#cb5-250" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Table 6</span><span class="sc">\n</span><span class="st">Linear Regression Coefficients for Credit Limit Model"</span>,</span>
<span id="cb5-251"><a href="#cb5-251" aria-hidden="true" tabindex="-1"></a>    <span class="at">digits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">0</span>),</span>
<span id="cb5-252"><a href="#cb5-252" aria-hidden="true" tabindex="-1"></a>    <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"l"</span>, <span class="st">"r"</span>, <span class="st">"r"</span>, <span class="st">"r"</span>, <span class="st">"r"</span>, <span class="st">"c"</span>)</span>
<span id="cb5-253"><a href="#cb5-253" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-254"><a href="#cb5-254" aria-hidden="true" tabindex="-1"></a><span class="co"># Split data into training (80%) and testing (20%)</span></span>
<span id="cb5-255"><a href="#cb5-255" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb5-256"><a href="#cb5-256" aria-hidden="true" tabindex="-1"></a>train_index <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(df<span class="sc">$</span>default, <span class="at">p =</span> <span class="fl">0.8</span>, <span class="at">list =</span> <span class="cn">FALSE</span>)</span>
<span id="cb5-257"><a href="#cb5-257" aria-hidden="true" tabindex="-1"></a>trainData <span class="ot">&lt;-</span> df[train_index, ]</span>
<span id="cb5-258"><a href="#cb5-258" aria-hidden="true" tabindex="-1"></a>testData  <span class="ot">&lt;-</span> df[<span class="sc">-</span>train_index, ]</span>
<span id="cb5-259"><a href="#cb5-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-260"><a href="#cb5-260" aria-hidden="true" tabindex="-1"></a><span class="co"># Train a logistic regression model</span></span>
<span id="cb5-261"><a href="#cb5-261" aria-hidden="true" tabindex="-1"></a>train_control <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"cv"</span>, <span class="at">number =</span> <span class="dv">10</span>, <span class="at">classProbs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb5-262"><a href="#cb5-262" aria-hidden="true" tabindex="-1"></a>                              <span class="at">summaryFunction =</span> twoClassSummary)  <span class="co"># use ROC for summary</span></span>
<span id="cb5-263"><a href="#cb5-263" aria-hidden="true" tabindex="-1"></a>logit_model <span class="ot">&lt;-</span> <span class="fu">train</span>(default <span class="sc">~</span> ., <span class="at">data =</span> trainData, <span class="at">method =</span> <span class="st">"glm"</span>, <span class="at">family =</span> <span class="st">"binomial"</span>,</span>
<span id="cb5-264"><a href="#cb5-264" aria-hidden="true" tabindex="-1"></a>                     <span class="at">trControl =</span> train_control, <span class="at">metric =</span> <span class="st">"ROC"</span>)</span>
<span id="cb5-265"><a href="#cb5-265" aria-hidden="true" tabindex="-1"></a><span class="co"># Cross-validated performance:</span></span>
<span id="cb5-266"><a href="#cb5-266" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(logit_model)</span>
<span id="cb5-267"><a href="#cb5-267" aria-hidden="true" tabindex="-1"></a><span class="co"># predict probabilities on test set</span></span>
<span id="cb5-268"><a href="#cb5-268" aria-hidden="true" tabindex="-1"></a>probs <span class="ot">&lt;-</span> <span class="fu">predict</span>(logit_model, <span class="at">newdata =</span> testData, <span class="at">type =</span> <span class="st">"prob"</span>)[, <span class="st">"Yes"</span>]</span>
<span id="cb5-269"><a href="#cb5-269" aria-hidden="true" tabindex="-1"></a>roc_obj <span class="ot">&lt;-</span> <span class="fu">roc</span>(testData<span class="sc">$</span>default, probs)</span>
<span id="cb5-270"><a href="#cb5-270" aria-hidden="true" tabindex="-1"></a><span class="fu">ggroc</span>(roc_obj) <span class="sc">+</span></span>
<span id="cb5-271"><a href="#cb5-271" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Figure 4: ROC Curve for Logistic Regression"</span>,</span>
<span id="cb5-272"><a href="#cb5-272" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"False Positive Rate (1 – Specificity)"</span>,</span>
<span id="cb5-273"><a href="#cb5-273" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"True Positive Rate (Sensitivity)"</span>) <span class="sc">+</span></span>
<span id="cb5-274"><a href="#cb5-274" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">0.6</span>, <span class="at">y =</span> <span class="fl">0.2</span>,</span>
<span id="cb5-275"><a href="#cb5-275" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">paste0</span>(<span class="st">"AUC = "</span>, <span class="fu">round</span>(<span class="fu">auc</span>(roc_obj), <span class="dv">2</span>))) <span class="sc">+</span></span>
<span id="cb5-276"><a href="#cb5-276" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb5-277"><a href="#cb5-277" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict on test data</span></span>
<span id="cb5-278"><a href="#cb5-278" aria-hidden="true" tabindex="-1"></a>logit_probs <span class="ot">&lt;-</span> <span class="fu">predict</span>(logit_model, <span class="at">newdata =</span> testData, <span class="at">type =</span> <span class="st">"prob"</span>)[, <span class="st">"Yes"</span>]</span>
<span id="cb5-279"><a href="#cb5-279" aria-hidden="true" tabindex="-1"></a>logit_pred  <span class="ot">&lt;-</span> <span class="fu">predict</span>(logit_model, <span class="at">newdata =</span> testData)  <span class="co"># predicted classes</span></span>
<span id="cb5-280"><a href="#cb5-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-281"><a href="#cb5-281" aria-hidden="true" tabindex="-1"></a><span class="co"># Confusion matrix and performance metrics</span></span>
<span id="cb5-282"><a href="#cb5-282" aria-hidden="true" tabindex="-1"></a>cm <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(logit_pred, testData<span class="sc">$</span>default, <span class="at">positive =</span> <span class="st">"Yes"</span>)</span>
<span id="cb5-283"><a href="#cb5-283" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the caret confusionMatrix table into a data frame</span></span>
<span id="cb5-284"><a href="#cb5-284" aria-hidden="true" tabindex="-1"></a>cm_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(cm<span class="sc">$</span>table) <span class="sc">%&gt;%</span></span>
<span id="cb5-285"><a href="#cb5-285" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb5-286"><a href="#cb5-286" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from  =</span> Reference,</span>
<span id="cb5-287"><a href="#cb5-287" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> Freq</span>
<span id="cb5-288"><a href="#cb5-288" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb5-289"><a href="#cb5-289" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Prediction =</span> Prediction)</span>
<span id="cb5-290"><a href="#cb5-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-291"><a href="#cb5-291" aria-hidden="true" tabindex="-1"></a>cm_df <span class="sc">%&gt;%</span></span>
<span id="cb5-292"><a href="#cb5-292" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(</span>
<span id="cb5-293"><a href="#cb5-293" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Confusion Matrix (Counts)"</span>,</span>
<span id="cb5-294"><a href="#cb5-294" aria-hidden="true" tabindex="-1"></a>    <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Predicted </span><span class="sc">\\</span><span class="st"> Actual"</span>, <span class="st">"No"</span>, <span class="st">"Yes"</span>),</span>
<span id="cb5-295"><a href="#cb5-295" aria-hidden="true" tabindex="-1"></a>    <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"l"</span>, <span class="st">"r"</span>, <span class="st">"r"</span>)</span>
<span id="cb5-296"><a href="#cb5-296" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-297"><a href="#cb5-297" aria-hidden="true" tabindex="-1"></a>cm_counts <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(cm<span class="sc">$</span>table) <span class="sc">%&gt;%</span></span>
<span id="cb5-298"><a href="#cb5-298" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb5-299"><a href="#cb5-299" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from  =</span> Reference,</span>
<span id="cb5-300"><a href="#cb5-300" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> Freq</span>
<span id="cb5-301"><a href="#cb5-301" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb5-302"><a href="#cb5-302" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Predicted =</span> Prediction)</span>
<span id="cb5-303"><a href="#cb5-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-304"><a href="#cb5-304" aria-hidden="true" tabindex="-1"></a>cm_stats <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb5-305"><a href="#cb5-305" aria-hidden="true" tabindex="-1"></a>  <span class="at">Metric =</span> <span class="fu">c</span>(</span>
<span id="cb5-306"><a href="#cb5-306" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Accuracy"</span>,</span>
<span id="cb5-307"><a href="#cb5-307" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Sensitivity (Recall)"</span>,</span>
<span id="cb5-308"><a href="#cb5-308" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Specificity"</span>,</span>
<span id="cb5-309"><a href="#cb5-309" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Precision (Pos Pred Value)"</span>,</span>
<span id="cb5-310"><a href="#cb5-310" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Negative Pred Value"</span></span>
<span id="cb5-311"><a href="#cb5-311" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb5-312"><a href="#cb5-312" aria-hidden="true" tabindex="-1"></a>  <span class="at">Value =</span> <span class="fu">c</span>(</span>
<span id="cb5-313"><a href="#cb5-313" aria-hidden="true" tabindex="-1"></a>    cm<span class="sc">$</span>overall[<span class="st">"Accuracy"</span>],</span>
<span id="cb5-314"><a href="#cb5-314" aria-hidden="true" tabindex="-1"></a>    cm<span class="sc">$</span>byClass[<span class="st">"Sensitivity"</span>],</span>
<span id="cb5-315"><a href="#cb5-315" aria-hidden="true" tabindex="-1"></a>    cm<span class="sc">$</span>byClass[<span class="st">"Specificity"</span>],</span>
<span id="cb5-316"><a href="#cb5-316" aria-hidden="true" tabindex="-1"></a>    cm<span class="sc">$</span>byClass[<span class="st">"Pos Pred Value"</span>],</span>
<span id="cb5-317"><a href="#cb5-317" aria-hidden="true" tabindex="-1"></a>    cm<span class="sc">$</span>byClass[<span class="st">"Neg Pred Value"</span>]</span>
<span id="cb5-318"><a href="#cb5-318" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-319"><a href="#cb5-319" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb5-320"><a href="#cb5-320" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Value =</span> <span class="fu">round</span>(Value, <span class="dv">3</span>))</span>
<span id="cb5-321"><a href="#cb5-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-322"><a href="#cb5-322" aria-hidden="true" tabindex="-1"></a>cm_counts <span class="sc">%&gt;%</span></span>
<span id="cb5-323"><a href="#cb5-323" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(</span>
<span id="cb5-324"><a href="#cb5-324" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Table 7</span><span class="sc">\n</span><span class="st">Confusion Matrix Counts"</span>,</span>
<span id="cb5-325"><a href="#cb5-325" aria-hidden="true" tabindex="-1"></a>    <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Predicted </span><span class="sc">\\</span><span class="st"> Actual"</span>, <span class="st">"No"</span>, <span class="st">"Yes"</span>),</span>
<span id="cb5-326"><a href="#cb5-326" aria-hidden="true" tabindex="-1"></a>    <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"l"</span>, <span class="st">"r"</span>, <span class="st">"r"</span>)</span>
<span id="cb5-327"><a href="#cb5-327" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb5-328"><a href="#cb5-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-329"><a href="#cb5-329" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width =</span> <span class="cn">FALSE</span>)</span>
<span id="cb5-330"><a href="#cb5-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-331"><a href="#cb5-331" aria-hidden="true" tabindex="-1"></a>cm_stats <span class="sc">%&gt;%</span></span>
<span id="cb5-332"><a href="#cb5-332" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(</span>
<span id="cb5-333"><a href="#cb5-333" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Table 8</span><span class="sc">\n</span><span class="st">Derived Performance Metrics"</span>,</span>
<span id="cb5-334"><a href="#cb5-334" aria-hidden="true" tabindex="-1"></a>    <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Metric"</span>, <span class="st">"Value"</span>),</span>
<span id="cb5-335"><a href="#cb5-335" aria-hidden="true" tabindex="-1"></a>    <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"l"</span>, <span class="st">"r"</span>)</span>
<span id="cb5-336"><a href="#cb5-336" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb5-337"><a href="#cb5-337" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width =</span> <span class="cn">FALSE</span>)</span>
<span id="cb5-338"><a href="#cb5-338" aria-hidden="true" tabindex="-1"></a>tree_model <span class="ot">&lt;-</span> <span class="fu">rpart</span>(default <span class="sc">~</span> ., <span class="at">data =</span> trainData, <span class="at">method =</span> <span class="st">"class"</span>, <span class="at">control =</span> <span class="fu">rpart.control</span>(<span class="at">cp =</span> <span class="fl">0.002</span>))</span>
<span id="cb5-339"><a href="#cb5-339" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.plot</span>(tree_model)</span>
<span id="cb5-340"><a href="#cb5-340" aria-hidden="true" tabindex="-1"></a>tree_pred_class <span class="ot">&lt;-</span> <span class="fu">predict</span>(tree_model, <span class="at">newdata =</span> testData, <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb5-341"><a href="#cb5-341" aria-hidden="true" tabindex="-1"></a>tree_pred_prob  <span class="ot">&lt;-</span> <span class="fu">predict</span>(tree_model, <span class="at">newdata =</span> testData, <span class="at">type =</span> <span class="st">"prob"</span>)[, <span class="st">"Yes"</span>]</span>
<span id="cb5-342"><a href="#cb5-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-343"><a href="#cb5-343" aria-hidden="true" tabindex="-1"></a>cm_tree <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(tree_pred_class, testData<span class="sc">$</span>default, <span class="at">positive =</span> <span class="st">"Yes"</span>)</span>
<span id="cb5-344"><a href="#cb5-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-345"><a href="#cb5-345" aria-hidden="true" tabindex="-1"></a>dt_counts <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(cm_tree<span class="sc">$</span>table) <span class="sc">%&gt;%</span></span>
<span id="cb5-346"><a href="#cb5-346" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb5-347"><a href="#cb5-347" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from  =</span> Reference,</span>
<span id="cb5-348"><a href="#cb5-348" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> Freq</span>
<span id="cb5-349"><a href="#cb5-349" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb5-350"><a href="#cb5-350" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Predicted =</span> Prediction)</span>
<span id="cb5-351"><a href="#cb5-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-352"><a href="#cb5-352" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the key performance metrics</span></span>
<span id="cb5-353"><a href="#cb5-353" aria-hidden="true" tabindex="-1"></a>dt_stats <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb5-354"><a href="#cb5-354" aria-hidden="true" tabindex="-1"></a>  <span class="at">Metric =</span> <span class="fu">c</span>(</span>
<span id="cb5-355"><a href="#cb5-355" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Accuracy"</span>,</span>
<span id="cb5-356"><a href="#cb5-356" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Sensitivity (Recall)"</span>,</span>
<span id="cb5-357"><a href="#cb5-357" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Specificity"</span>,</span>
<span id="cb5-358"><a href="#cb5-358" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Precision (Pos Pred Value)"</span>,</span>
<span id="cb5-359"><a href="#cb5-359" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Negative Pred Value"</span></span>
<span id="cb5-360"><a href="#cb5-360" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb5-361"><a href="#cb5-361" aria-hidden="true" tabindex="-1"></a>  <span class="at">Value =</span> <span class="fu">c</span>(</span>
<span id="cb5-362"><a href="#cb5-362" aria-hidden="true" tabindex="-1"></a>    cm_tree<span class="sc">$</span>overall[<span class="st">"Accuracy"</span>],</span>
<span id="cb5-363"><a href="#cb5-363" aria-hidden="true" tabindex="-1"></a>    cm_tree<span class="sc">$</span>byClass[<span class="st">"Sensitivity"</span>],</span>
<span id="cb5-364"><a href="#cb5-364" aria-hidden="true" tabindex="-1"></a>    cm_tree<span class="sc">$</span>byClass[<span class="st">"Specificity"</span>],</span>
<span id="cb5-365"><a href="#cb5-365" aria-hidden="true" tabindex="-1"></a>    cm_tree<span class="sc">$</span>byClass[<span class="st">"Pos Pred Value"</span>],</span>
<span id="cb5-366"><a href="#cb5-366" aria-hidden="true" tabindex="-1"></a>    cm_tree<span class="sc">$</span>byClass[<span class="st">"Neg Pred Value"</span>]</span>
<span id="cb5-367"><a href="#cb5-367" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-368"><a href="#cb5-368" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb5-369"><a href="#cb5-369" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Value =</span> <span class="fu">round</span>(Value, <span class="dv">3</span>))</span>
<span id="cb5-370"><a href="#cb5-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-371"><a href="#cb5-371" aria-hidden="true" tabindex="-1"></a>dt_counts <span class="sc">%&gt;%</span></span>
<span id="cb5-372"><a href="#cb5-372" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(</span>
<span id="cb5-373"><a href="#cb5-373" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Table 9</span><span class="sc">\n</span><span class="st">Decision Tree: Confusion Matrix Counts"</span>,</span>
<span id="cb5-374"><a href="#cb5-374" aria-hidden="true" tabindex="-1"></a>    <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Predicted </span><span class="sc">\\</span><span class="st"> Actual"</span>, <span class="st">"No"</span>, <span class="st">"Yes"</span>),</span>
<span id="cb5-375"><a href="#cb5-375" aria-hidden="true" tabindex="-1"></a>    <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"l"</span>, <span class="st">"r"</span>, <span class="st">"r"</span>)</span>
<span id="cb5-376"><a href="#cb5-376" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-377"><a href="#cb5-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-378"><a href="#cb5-378" aria-hidden="true" tabindex="-1"></a>dt_stats <span class="sc">%&gt;%</span></span>
<span id="cb5-379"><a href="#cb5-379" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(</span>
<span id="cb5-380"><a href="#cb5-380" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Table 10</span><span class="sc">\n</span><span class="st">Decision Tree: Performance Metrics"</span>,</span>
<span id="cb5-381"><a href="#cb5-381" aria-hidden="true" tabindex="-1"></a>    <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Metric"</span>, <span class="st">"Value"</span>),</span>
<span id="cb5-382"><a href="#cb5-382" aria-hidden="true" tabindex="-1"></a>    <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"l"</span>, <span class="st">"r"</span>)</span>
<span id="cb5-383"><a href="#cb5-383" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-384"><a href="#cb5-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-385"><a href="#cb5-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-386"><a href="#cb5-386" aria-hidden="true" tabindex="-1"></a>roc_obj <span class="ot">&lt;-</span> <span class="fu">roc</span>(<span class="at">response =</span> testData<span class="sc">$</span>default,</span>
<span id="cb5-387"><a href="#cb5-387" aria-hidden="true" tabindex="-1"></a>               <span class="at">predictor =</span> tree_pred_prob,</span>
<span id="cb5-388"><a href="#cb5-388" aria-hidden="true" tabindex="-1"></a>               <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"No"</span>,<span class="st">"Yes"</span>))</span>
<span id="cb5-389"><a href="#cb5-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-390"><a href="#cb5-390" aria-hidden="true" tabindex="-1"></a>auc_value <span class="ot">&lt;-</span> <span class="fu">auc</span>(roc_obj)</span>
<span id="cb5-391"><a href="#cb5-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-392"><a href="#cb5-392" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(roc_obj, </span>
<span id="cb5-393"><a href="#cb5-393" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Figure 5: ROC Curve: Decision Tree"</span>,</span>
<span id="cb5-394"><a href="#cb5-394" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb5-395"><a href="#cb5-395" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a =</span> <span class="dv">0</span>, <span class="at">b =</span> <span class="dv">1</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"gray"</span>)</span>
<span id="cb5-396"><a href="#cb5-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-397"><a href="#cb5-397" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"bottomright"</span>,</span>
<span id="cb5-398"><a href="#cb5-398" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">paste0</span>(<span class="st">"AUC = "</span>, <span class="fu">round</span>(auc_value, <span class="dv">2</span>)),</span>
<span id="cb5-399"><a href="#cb5-399" aria-hidden="true" tabindex="-1"></a>       <span class="at">bty =</span> <span class="st">"n"</span>)</span>
<span id="cb5-400"><a href="#cb5-400" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2025</span>)</span>
<span id="cb5-401"><a href="#cb5-401" aria-hidden="true" tabindex="-1"></a>rf_model <span class="ot">&lt;-</span> <span class="fu">randomForest</span>(default <span class="sc">~</span> ., <span class="at">data =</span> trainData, <span class="at">ntree =</span> <span class="dv">100</span>, <span class="at">importance =</span> <span class="cn">TRUE</span>)</span>
<span id="cb5-402"><a href="#cb5-402" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(rf_model)</span>
<span id="cb5-403"><a href="#cb5-403" aria-hidden="true" tabindex="-1"></a>rf_pred   <span class="ot">&lt;-</span> <span class="fu">predict</span>(rf_model,     <span class="at">newdata =</span> testData)</span>
<span id="cb5-404"><a href="#cb5-404" aria-hidden="true" tabindex="-1"></a>cm_rf <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(rf_pred, testData<span class="sc">$</span>default, <span class="at">positive=</span><span class="st">"Yes"</span>)</span>
<span id="cb5-405"><a href="#cb5-405" aria-hidden="true" tabindex="-1"></a>rf_prob   <span class="ot">&lt;-</span> <span class="fu">predict</span>(rf_model, <span class="at">newdata =</span> testData, <span class="at">type =</span> <span class="st">"prob"</span>)[, <span class="st">"Yes"</span>]</span>
<span id="cb5-406"><a href="#cb5-406" aria-hidden="true" tabindex="-1"></a>roc_rf <span class="ot">&lt;-</span> <span class="fu">roc</span>(</span>
<span id="cb5-407"><a href="#cb5-407" aria-hidden="true" tabindex="-1"></a>  <span class="at">response  =</span> testData<span class="sc">$</span>default,  </span>
<span id="cb5-408"><a href="#cb5-408" aria-hidden="true" tabindex="-1"></a>  <span class="at">predictor =</span> rf_prob,  </span>
<span id="cb5-409"><a href="#cb5-409" aria-hidden="true" tabindex="-1"></a>  <span class="at">levels    =</span> <span class="fu">c</span>(<span class="st">"No"</span>,<span class="st">"Yes"</span>)</span>
<span id="cb5-410"><a href="#cb5-410" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-411"><a href="#cb5-411" aria-hidden="true" tabindex="-1"></a>auc_value <span class="ot">&lt;-</span> <span class="fu">auc</span>(roc_rf)</span>
<span id="cb5-412"><a href="#cb5-412" aria-hidden="true" tabindex="-1"></a>rf_counts <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(cm_rf<span class="sc">$</span>table) <span class="sc">%&gt;%</span></span>
<span id="cb5-413"><a href="#cb5-413" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb5-414"><a href="#cb5-414" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from  =</span> Reference,</span>
<span id="cb5-415"><a href="#cb5-415" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> Freq</span>
<span id="cb5-416"><a href="#cb5-416" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb5-417"><a href="#cb5-417" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Predicted =</span> Prediction)</span>
<span id="cb5-418"><a href="#cb5-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-419"><a href="#cb5-419" aria-hidden="true" tabindex="-1"></a>rf_stats <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb5-420"><a href="#cb5-420" aria-hidden="true" tabindex="-1"></a>  <span class="at">Metric =</span> <span class="fu">c</span>(</span>
<span id="cb5-421"><a href="#cb5-421" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Accuracy"</span>,</span>
<span id="cb5-422"><a href="#cb5-422" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Sensitivity (Recall)"</span>,</span>
<span id="cb5-423"><a href="#cb5-423" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Specificity"</span>,</span>
<span id="cb5-424"><a href="#cb5-424" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Precision (Pos Pred Value)"</span>,</span>
<span id="cb5-425"><a href="#cb5-425" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Negative Pred Value"</span></span>
<span id="cb5-426"><a href="#cb5-426" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb5-427"><a href="#cb5-427" aria-hidden="true" tabindex="-1"></a>  <span class="at">Value =</span> <span class="fu">c</span>(</span>
<span id="cb5-428"><a href="#cb5-428" aria-hidden="true" tabindex="-1"></a>    cm_rf<span class="sc">$</span>overall[<span class="st">"Accuracy"</span>],</span>
<span id="cb5-429"><a href="#cb5-429" aria-hidden="true" tabindex="-1"></a>    cm_rf<span class="sc">$</span>byClass[<span class="st">"Sensitivity"</span>],</span>
<span id="cb5-430"><a href="#cb5-430" aria-hidden="true" tabindex="-1"></a>    cm_rf<span class="sc">$</span>byClass[<span class="st">"Specificity"</span>],</span>
<span id="cb5-431"><a href="#cb5-431" aria-hidden="true" tabindex="-1"></a>    cm_rf<span class="sc">$</span>byClass[<span class="st">"Pos Pred Value"</span>],</span>
<span id="cb5-432"><a href="#cb5-432" aria-hidden="true" tabindex="-1"></a>    cm_rf<span class="sc">$</span>byClass[<span class="st">"Neg Pred Value"</span>]</span>
<span id="cb5-433"><a href="#cb5-433" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-434"><a href="#cb5-434" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb5-435"><a href="#cb5-435" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Value =</span> <span class="fu">round</span>(Value, <span class="dv">3</span>))</span>
<span id="cb5-436"><a href="#cb5-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-437"><a href="#cb5-437" aria-hidden="true" tabindex="-1"></a>rf_counts <span class="sc">%&gt;%</span></span>
<span id="cb5-438"><a href="#cb5-438" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(</span>
<span id="cb5-439"><a href="#cb5-439" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Table 11</span><span class="sc">\n</span><span class="st">Random Forest: Confusion Matrix Counts"</span>,</span>
<span id="cb5-440"><a href="#cb5-440" aria-hidden="true" tabindex="-1"></a>    <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Predicted </span><span class="sc">\\</span><span class="st"> Actual"</span>, <span class="st">"No"</span>, <span class="st">"Yes"</span>),</span>
<span id="cb5-441"><a href="#cb5-441" aria-hidden="true" tabindex="-1"></a>    <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"l"</span>, <span class="st">"r"</span>, <span class="st">"r"</span>)</span>
<span id="cb5-442"><a href="#cb5-442" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-443"><a href="#cb5-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-444"><a href="#cb5-444" aria-hidden="true" tabindex="-1"></a>rf_stats <span class="sc">%&gt;%</span></span>
<span id="cb5-445"><a href="#cb5-445" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(</span>
<span id="cb5-446"><a href="#cb5-446" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Table 12</span><span class="sc">\n</span><span class="st">Random Forest: Performance Metrics"</span>,</span>
<span id="cb5-447"><a href="#cb5-447" aria-hidden="true" tabindex="-1"></a>    <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Metric"</span>, <span class="st">"Value"</span>),</span>
<span id="cb5-448"><a href="#cb5-448" aria-hidden="true" tabindex="-1"></a>    <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"l"</span>, <span class="st">"r"</span>)</span>
<span id="cb5-449"><a href="#cb5-449" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-450"><a href="#cb5-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-451"><a href="#cb5-451" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(roc_rf, </span>
<span id="cb5-452"><a href="#cb5-452" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Figure 6: ROC Curve: Random Forest"</span>,</span>
<span id="cb5-453"><a href="#cb5-453" aria-hidden="true" tabindex="-1"></a>     <span class="at">col  =</span> <span class="st">"black"</span>,</span>
<span id="cb5-454"><a href="#cb5-454" aria-hidden="true" tabindex="-1"></a>     <span class="at">lwd  =</span> <span class="dv">2</span>)</span>
<span id="cb5-455"><a href="#cb5-455" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a =</span> <span class="dv">0</span>, <span class="at">b =</span> <span class="dv">1</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"gray"</span>)</span>
<span id="cb5-456"><a href="#cb5-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-457"><a href="#cb5-457" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"bottomright"</span>,</span>
<span id="cb5-458"><a href="#cb5-458" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">sprintf</span>(<span class="st">"AUC = %.2f"</span>, auc_value),</span>
<span id="cb5-459"><a href="#cb5-459" aria-hidden="true" tabindex="-1"></a>       <span class="at">bty    =</span> <span class="st">"n"</span>,</span>
<span id="cb5-460"><a href="#cb5-460" aria-hidden="true" tabindex="-1"></a>       <span class="at">text.col =</span> <span class="st">"black"</span>,</span>
<span id="cb5-461"><a href="#cb5-461" aria-hidden="true" tabindex="-1"></a>       <span class="at">cex    =</span> <span class="fl">1.2</span>)</span>
<span id="cb5-462"><a href="#cb5-462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-463"><a href="#cb5-463" aria-hidden="true" tabindex="-1"></a><span class="fu">varImpPlot</span>(rf_model,</span>
<span id="cb5-464"><a href="#cb5-464" aria-hidden="true" tabindex="-1"></a>           <span class="at">type =</span> <span class="dv">2</span>,         </span>
<span id="cb5-465"><a href="#cb5-465" aria-hidden="true" tabindex="-1"></a>           <span class="at">n.var =</span> <span class="dv">15</span>,       </span>
<span id="cb5-466"><a href="#cb5-466" aria-hidden="true" tabindex="-1"></a>           <span class="at">main =</span> <span class="st">"Figure 7: Variable Importance (Mean Decrease Gini)"</span>)</span>
<span id="cb5-467"><a href="#cb5-467" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xgboost)</span>
<span id="cb5-468"><a href="#cb5-468" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare data matrices for XGBoost</span></span>
<span id="cb5-469"><a href="#cb5-469" aria-hidden="true" tabindex="-1"></a>train_matrix <span class="ot">&lt;-</span> <span class="fu">xgb.DMatrix</span>(<span class="at">data =</span> <span class="fu">data.matrix</span>(trainData <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>default)), </span>
<span id="cb5-470"><a href="#cb5-470" aria-hidden="true" tabindex="-1"></a>                             <span class="at">label =</span> <span class="fu">ifelse</span>(trainData<span class="sc">$</span>default<span class="sc">==</span><span class="st">"Yes"</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb5-471"><a href="#cb5-471" aria-hidden="true" tabindex="-1"></a>test_matrix  <span class="ot">&lt;-</span> <span class="fu">xgb.DMatrix</span>(<span class="at">data =</span> <span class="fu">data.matrix</span>(testData <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>default)), </span>
<span id="cb5-472"><a href="#cb5-472" aria-hidden="true" tabindex="-1"></a>                             <span class="at">label =</span> <span class="fu">ifelse</span>(testData<span class="sc">$</span>default<span class="sc">==</span><span class="st">"Yes"</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb5-473"><a href="#cb5-473" aria-hidden="true" tabindex="-1"></a><span class="co"># Train XGBoost model with 100 rounds</span></span>
<span id="cb5-474"><a href="#cb5-474" aria-hidden="true" tabindex="-1"></a>xgb_model <span class="ot">&lt;-</span> <span class="fu">xgboost</span>(<span class="at">data =</span> train_matrix, <span class="at">objective =</span> <span class="st">"binary:logistic"</span>, <span class="at">nrounds =</span> <span class="dv">100</span>, </span>
<span id="cb5-475"><a href="#cb5-475" aria-hidden="true" tabindex="-1"></a>                     <span class="at">eval_metric =</span> <span class="st">"auc"</span>, <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span>
<span id="cb5-476"><a href="#cb5-476" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict on test set</span></span>
<span id="cb5-477"><a href="#cb5-477" aria-hidden="true" tabindex="-1"></a>xgb_pred_prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(xgb_model, test_matrix)</span>
<span id="cb5-478"><a href="#cb5-478" aria-hidden="true" tabindex="-1"></a>xgb_pred <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(xgb_pred_prob <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="st">"Yes"</span>, <span class="st">"No"</span>) <span class="sc">%&gt;%</span> <span class="fu">factor</span>(<span class="at">levels=</span><span class="fu">c</span>(<span class="st">"No"</span>,<span class="st">"Yes"</span>))</span>
<span id="cb5-479"><a href="#cb5-479" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(xgb_pred, testData<span class="sc">$</span>default, <span class="at">positive=</span><span class="st">"Yes"</span>)</span>
<span id="cb5-480"><a href="#cb5-480" aria-hidden="true" tabindex="-1"></a>cm_xgb <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(xgb_pred, testData<span class="sc">$</span>default, <span class="at">positive =</span> <span class="st">"Yes"</span>)</span>
<span id="cb5-481"><a href="#cb5-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-482"><a href="#cb5-482" aria-hidden="true" tabindex="-1"></a>precision <span class="ot">&lt;-</span> cm_xgb<span class="sc">$</span>byClass[<span class="st">"Pos Pred Value"</span>]   </span>
<span id="cb5-483"><a href="#cb5-483" aria-hidden="true" tabindex="-1"></a>recall    <span class="ot">&lt;-</span> cm_xgb<span class="sc">$</span>byClass[<span class="st">"Sensitivity"</span>]      </span>
<span id="cb5-484"><a href="#cb5-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-485"><a href="#cb5-485" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute F1‐score</span></span>
<span id="cb5-486"><a href="#cb5-486" aria-hidden="true" tabindex="-1"></a>f1_score <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> (precision <span class="sc">*</span> recall) <span class="sc">/</span> (precision <span class="sc">+</span> recall)</span>
<span id="cb5-487"><a href="#cb5-487" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">"F1‐score = "</span>, <span class="fu">round</span>(f1_score, <span class="dv">3</span>)))</span>
<span id="cb5-488"><a href="#cb5-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-489"><a href="#cb5-489" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute AUC using the probability predictions</span></span>
<span id="cb5-490"><a href="#cb5-490" aria-hidden="true" tabindex="-1"></a>roc_xgb   <span class="ot">&lt;-</span> <span class="fu">roc</span>(<span class="at">response  =</span> testData<span class="sc">$</span>default,</span>
<span id="cb5-491"><a href="#cb5-491" aria-hidden="true" tabindex="-1"></a>                 <span class="at">predictor =</span> xgb_pred_prob,</span>
<span id="cb5-492"><a href="#cb5-492" aria-hidden="true" tabindex="-1"></a>                 <span class="at">levels    =</span> <span class="fu">c</span>(<span class="st">"No"</span>,<span class="st">"Yes"</span>))</span>
<span id="cb5-493"><a href="#cb5-493" aria-hidden="true" tabindex="-1"></a>auc_xgb   <span class="ot">&lt;-</span> <span class="fu">auc</span>(roc_xgb)</span>
<span id="cb5-494"><a href="#cb5-494" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">"AUC = "</span>, <span class="fu">round</span>(auc_xgb, <span class="dv">3</span>)))</span>
<span id="cb5-495"><a href="#cb5-495" aria-hidden="true" tabindex="-1"></a>rf_counts <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(cm_xgb<span class="sc">$</span>table) <span class="sc">%&gt;%</span></span>
<span id="cb5-496"><a href="#cb5-496" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb5-497"><a href="#cb5-497" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from  =</span> Reference,</span>
<span id="cb5-498"><a href="#cb5-498" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> Freq</span>
<span id="cb5-499"><a href="#cb5-499" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb5-500"><a href="#cb5-500" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Predicted =</span> Prediction)</span>
<span id="cb5-501"><a href="#cb5-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-502"><a href="#cb5-502" aria-hidden="true" tabindex="-1"></a>rf_stats <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb5-503"><a href="#cb5-503" aria-hidden="true" tabindex="-1"></a>  <span class="at">Metric =</span> <span class="fu">c</span>(</span>
<span id="cb5-504"><a href="#cb5-504" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Accuracy"</span>,</span>
<span id="cb5-505"><a href="#cb5-505" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Sensitivity (Recall)"</span>,</span>
<span id="cb5-506"><a href="#cb5-506" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Specificity"</span>,</span>
<span id="cb5-507"><a href="#cb5-507" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Precision (Pos Pred Value)"</span>,</span>
<span id="cb5-508"><a href="#cb5-508" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Negative Predictive Value"</span></span>
<span id="cb5-509"><a href="#cb5-509" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb5-510"><a href="#cb5-510" aria-hidden="true" tabindex="-1"></a>  <span class="at">Value =</span> <span class="fu">c</span>(</span>
<span id="cb5-511"><a href="#cb5-511" aria-hidden="true" tabindex="-1"></a>    cm_xgb<span class="sc">$</span>overall[<span class="st">"Accuracy"</span>],</span>
<span id="cb5-512"><a href="#cb5-512" aria-hidden="true" tabindex="-1"></a>    cm_xgb<span class="sc">$</span>byClass[<span class="st">"Sensitivity"</span>],</span>
<span id="cb5-513"><a href="#cb5-513" aria-hidden="true" tabindex="-1"></a>    cm_xgb<span class="sc">$</span>byClass[<span class="st">"Specificity"</span>],</span>
<span id="cb5-514"><a href="#cb5-514" aria-hidden="true" tabindex="-1"></a>    cm_xgb<span class="sc">$</span>byClass[<span class="st">"Pos Pred Value"</span>],</span>
<span id="cb5-515"><a href="#cb5-515" aria-hidden="true" tabindex="-1"></a>    cm_xgb<span class="sc">$</span>byClass[<span class="st">"Neg Pred Value"</span>]</span>
<span id="cb5-516"><a href="#cb5-516" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-517"><a href="#cb5-517" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb5-518"><a href="#cb5-518" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Value =</span> <span class="fu">round</span>(Value, <span class="dv">3</span>))</span>
<span id="cb5-519"><a href="#cb5-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-520"><a href="#cb5-520" aria-hidden="true" tabindex="-1"></a>rf_counts <span class="sc">%&gt;%</span></span>
<span id="cb5-521"><a href="#cb5-521" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(</span>
<span id="cb5-522"><a href="#cb5-522" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Table 13</span><span class="sc">\n</span><span class="st">XGBoost: Confusion Matrix Counts"</span>,</span>
<span id="cb5-523"><a href="#cb5-523" aria-hidden="true" tabindex="-1"></a>    <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Predicted </span><span class="sc">\\</span><span class="st"> Actual"</span>, <span class="st">"No"</span>, <span class="st">"Yes"</span>),</span>
<span id="cb5-524"><a href="#cb5-524" aria-hidden="true" tabindex="-1"></a>    <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"l"</span>,<span class="st">"r"</span>,<span class="st">"r"</span>)</span>
<span id="cb5-525"><a href="#cb5-525" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-526"><a href="#cb5-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-527"><a href="#cb5-527" aria-hidden="true" tabindex="-1"></a>rf_stats <span class="sc">%&gt;%</span></span>
<span id="cb5-528"><a href="#cb5-528" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(</span>
<span id="cb5-529"><a href="#cb5-529" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Table 14</span><span class="sc">\n</span><span class="st">XGBoost: Performance Metrics"</span>,</span>
<span id="cb5-530"><a href="#cb5-530" aria-hidden="true" tabindex="-1"></a>    <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Metric"</span>, <span class="st">"Value"</span>),</span>
<span id="cb5-531"><a href="#cb5-531" aria-hidden="true" tabindex="-1"></a>    <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"l"</span>,<span class="st">"r"</span>)</span>
<span id="cb5-532"><a href="#cb5-532" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-533"><a href="#cb5-533" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot ROC</span></span>
<span id="cb5-534"><a href="#cb5-534" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(roc_xgb, <span class="at">main =</span> <span class="st">"Figure 8: ROC Curve: XGBoost"</span>, <span class="at">col=</span><span class="st">"black"</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb5-535"><a href="#cb5-535" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a=</span><span class="dv">0</span>, <span class="at">b=</span><span class="dv">1</span>, <span class="at">lty=</span><span class="dv">2</span>, <span class="at">col=</span><span class="st">"gray"</span>)</span>
<span id="cb5-536"><a href="#cb5-536" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"bottomright"</span>,</span>
<span id="cb5-537"><a href="#cb5-537" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="fu">paste0</span>(<span class="st">"AUC = "</span>, <span class="fu">round</span>(auc_xgb, <span class="dv">2</span>))),</span>
<span id="cb5-538"><a href="#cb5-538" aria-hidden="true" tabindex="-1"></a>       <span class="at">bty    =</span> <span class="st">"n"</span>)</span>
<span id="cb5-539"><a href="#cb5-539" aria-hidden="true" tabindex="-1"></a>feat_names <span class="ot">&lt;-</span> <span class="fu">colnames</span>(trainData <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>default))</span>
<span id="cb5-540"><a href="#cb5-540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-541"><a href="#cb5-541" aria-hidden="true" tabindex="-1"></a>importance_matrix <span class="ot">&lt;-</span> <span class="fu">xgb.importance</span>(</span>
<span id="cb5-542"><a href="#cb5-542" aria-hidden="true" tabindex="-1"></a>  <span class="at">feature_names =</span> feat_names,</span>
<span id="cb5-543"><a href="#cb5-543" aria-hidden="true" tabindex="-1"></a>  <span class="at">model         =</span> xgb_model</span>
<span id="cb5-544"><a href="#cb5-544" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-545"><a href="#cb5-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-546"><a href="#cb5-546" aria-hidden="true" tabindex="-1"></a><span class="fu">xgb.plot.importance</span>(importance_matrix[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, ], </span>
<span id="cb5-547"><a href="#cb5-547" aria-hidden="true" tabindex="-1"></a>                    <span class="at">rel_to_first =</span> <span class="cn">TRUE</span>, </span>
<span id="cb5-548"><a href="#cb5-548" aria-hidden="true" tabindex="-1"></a>                    <span class="at">xlab =</span> <span class="st">"Relative Gain"</span>,</span>
<span id="cb5-549"><a href="#cb5-549" aria-hidden="true" tabindex="-1"></a>                    <span class="at">main =</span> <span class="st">"Figure 9: XGBoost Variable Importance (Top 10 by Gain)"</span>)</span>
<span id="cb5-550"><a href="#cb5-550" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb5-551"><a href="#cb5-551" aria-hidden="true" tabindex="-1"></a>svm_train <span class="ot">&lt;-</span> trainData <span class="sc">%&gt;%</span> <span class="fu">sample_frac</span>(<span class="fl">0.5</span>)</span>
<span id="cb5-552"><a href="#cb5-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-553"><a href="#cb5-553" aria-hidden="true" tabindex="-1"></a><span class="co"># Tune over a few C values</span></span>
<span id="cb5-554"><a href="#cb5-554" aria-hidden="true" tabindex="-1"></a>tune_res <span class="ot">&lt;-</span> <span class="fu">tune.svm</span>(</span>
<span id="cb5-555"><a href="#cb5-555" aria-hidden="true" tabindex="-1"></a>  default <span class="sc">~</span> .,</span>
<span id="cb5-556"><a href="#cb5-556" aria-hidden="true" tabindex="-1"></a>  <span class="at">data    =</span> svm_train,</span>
<span id="cb5-557"><a href="#cb5-557" aria-hidden="true" tabindex="-1"></a>  <span class="at">kernel  =</span> <span class="st">"radial"</span>,</span>
<span id="cb5-558"><a href="#cb5-558" aria-hidden="true" tabindex="-1"></a>  <span class="at">cost    =</span> <span class="fu">c</span>(<span class="fl">0.01</span>, <span class="fl">0.1</span>, <span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">100</span>),</span>
<span id="cb5-559"><a href="#cb5-559" aria-hidden="true" tabindex="-1"></a>  <span class="at">tunecontrol =</span> <span class="fu">tune.control</span>(<span class="at">cross =</span> <span class="dv">5</span>)  <span class="co"># 5‐fold CV</span></span>
<span id="cb5-560"><a href="#cb5-560" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-561"><a href="#cb5-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-562"><a href="#cb5-562" aria-hidden="true" tabindex="-1"></a>best_model <span class="ot">&lt;-</span> tune_res<span class="sc">$</span>best.model</span>
<span id="cb5-563"><a href="#cb5-563" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(tune_res<span class="sc">$</span>best.parameters)</span>
<span id="cb5-564"><a href="#cb5-564" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(e1071)</span>
<span id="cb5-565"><a href="#cb5-565" aria-hidden="true" tabindex="-1"></a>svm_model <span class="ot">&lt;-</span> <span class="fu">svm</span>(default <span class="sc">~</span> ., <span class="at">data =</span> trainData[<span class="dv">1</span><span class="sc">:</span><span class="dv">12000</span>, ], <span class="at">kernel =</span> <span class="st">"radial"</span>, <span class="at">cost =</span> <span class="dv">1</span>, <span class="at">probability =</span> <span class="cn">TRUE</span>, <span class="at">scale =</span> <span class="cn">TRUE</span>)</span>
<span id="cb5-566"><a href="#cb5-566" aria-hidden="true" tabindex="-1"></a>svm_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(svm_model, testData)</span>
<span id="cb5-567"><a href="#cb5-567" aria-hidden="true" tabindex="-1"></a>cm_svm <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(svm_pred, testData<span class="sc">$</span>default, <span class="at">positive =</span> <span class="st">"Yes"</span>)</span>
<span id="cb5-568"><a href="#cb5-568" aria-hidden="true" tabindex="-1"></a>svm_counts <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(cm_svm<span class="sc">$</span>table) <span class="sc">%&gt;%</span></span>
<span id="cb5-569"><a href="#cb5-569" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb5-570"><a href="#cb5-570" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from  =</span> Reference,</span>
<span id="cb5-571"><a href="#cb5-571" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> Freq</span>
<span id="cb5-572"><a href="#cb5-572" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb5-573"><a href="#cb5-573" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Predicted =</span> Prediction)</span>
<span id="cb5-574"><a href="#cb5-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-575"><a href="#cb5-575" aria-hidden="true" tabindex="-1"></a>svm_stats <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb5-576"><a href="#cb5-576" aria-hidden="true" tabindex="-1"></a>  <span class="at">Metric =</span> <span class="fu">c</span>(</span>
<span id="cb5-577"><a href="#cb5-577" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Accuracy"</span>,</span>
<span id="cb5-578"><a href="#cb5-578" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Sensitivity (Recall)"</span>,</span>
<span id="cb5-579"><a href="#cb5-579" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Specificity"</span>,</span>
<span id="cb5-580"><a href="#cb5-580" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Precision (Pos Pred Value)"</span>,</span>
<span id="cb5-581"><a href="#cb5-581" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Negative Predictive Value"</span></span>
<span id="cb5-582"><a href="#cb5-582" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb5-583"><a href="#cb5-583" aria-hidden="true" tabindex="-1"></a>  <span class="at">Value =</span> <span class="fu">c</span>(</span>
<span id="cb5-584"><a href="#cb5-584" aria-hidden="true" tabindex="-1"></a>    cm_svm<span class="sc">$</span>overall[<span class="st">"Accuracy"</span>],</span>
<span id="cb5-585"><a href="#cb5-585" aria-hidden="true" tabindex="-1"></a>    cm_svm<span class="sc">$</span>byClass[<span class="st">"Sensitivity"</span>],</span>
<span id="cb5-586"><a href="#cb5-586" aria-hidden="true" tabindex="-1"></a>    cm_svm<span class="sc">$</span>byClass[<span class="st">"Specificity"</span>],</span>
<span id="cb5-587"><a href="#cb5-587" aria-hidden="true" tabindex="-1"></a>    cm_svm<span class="sc">$</span>byClass[<span class="st">"Pos Pred Value"</span>],</span>
<span id="cb5-588"><a href="#cb5-588" aria-hidden="true" tabindex="-1"></a>    cm_svm<span class="sc">$</span>byClass[<span class="st">"Neg Pred Value"</span>]</span>
<span id="cb5-589"><a href="#cb5-589" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-590"><a href="#cb5-590" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb5-591"><a href="#cb5-591" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Value =</span> <span class="fu">round</span>(Value, <span class="dv">3</span>))</span>
<span id="cb5-592"><a href="#cb5-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-593"><a href="#cb5-593" aria-hidden="true" tabindex="-1"></a>svm_counts <span class="sc">%&gt;%</span></span>
<span id="cb5-594"><a href="#cb5-594" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(</span>
<span id="cb5-595"><a href="#cb5-595" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Table 15</span><span class="sc">\n</span><span class="st">: SVM (RBF): Confusion Matrix Counts"</span>,</span>
<span id="cb5-596"><a href="#cb5-596" aria-hidden="true" tabindex="-1"></a>    <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Predicted </span><span class="sc">\\</span><span class="st"> Actual"</span>, <span class="st">"No"</span>, <span class="st">"Yes"</span>),</span>
<span id="cb5-597"><a href="#cb5-597" aria-hidden="true" tabindex="-1"></a>    <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"l"</span>, <span class="st">"r"</span>, <span class="st">"r"</span>)</span>
<span id="cb5-598"><a href="#cb5-598" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-599"><a href="#cb5-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-600"><a href="#cb5-600" aria-hidden="true" tabindex="-1"></a>svm_stats <span class="sc">%&gt;%</span></span>
<span id="cb5-601"><a href="#cb5-601" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(</span>
<span id="cb5-602"><a href="#cb5-602" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Table 16</span><span class="sc">\n</span><span class="st">SVM (RBF): Performance Metrics"</span>,</span>
<span id="cb5-603"><a href="#cb5-603" aria-hidden="true" tabindex="-1"></a>    <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Metric"</span>, <span class="st">"Value"</span>),</span>
<span id="cb5-604"><a href="#cb5-604" aria-hidden="true" tabindex="-1"></a>    <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"l"</span>, <span class="st">"r"</span>)</span>
<span id="cb5-605"><a href="#cb5-605" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-606"><a href="#cb5-606" aria-hidden="true" tabindex="-1"></a>svm_prob  <span class="ot">&lt;-</span> <span class="fu">attr</span>(<span class="fu">predict</span>(svm_model, testData, <span class="at">probability =</span> <span class="cn">TRUE</span>), </span>
<span id="cb5-607"><a href="#cb5-607" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"probabilities"</span>)[, <span class="st">"Yes"</span>]</span>
<span id="cb5-608"><a href="#cb5-608" aria-hidden="true" tabindex="-1"></a>roc_svm <span class="ot">&lt;-</span> <span class="fu">roc</span>(<span class="at">response  =</span> testData<span class="sc">$</span>default,</span>
<span id="cb5-609"><a href="#cb5-609" aria-hidden="true" tabindex="-1"></a>               <span class="at">predictor =</span> svm_prob,</span>
<span id="cb5-610"><a href="#cb5-610" aria-hidden="true" tabindex="-1"></a>               <span class="at">levels    =</span> <span class="fu">c</span>(<span class="st">"No"</span>,<span class="st">"Yes"</span>))</span>
<span id="cb5-611"><a href="#cb5-611" aria-hidden="true" tabindex="-1"></a>auc_svm <span class="ot">&lt;-</span> <span class="fu">auc</span>(roc_svm)</span>
<span id="cb5-612"><a href="#cb5-612" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(roc_svm, <span class="at">main =</span> <span class="st">"Figure 10: ROC Curve: SVM"</span>, <span class="at">col =</span> <span class="st">"darkgreen"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb5-613"><a href="#cb5-613" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"gray"</span>)</span>
<span id="cb5-614"><a href="#cb5-614" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"bottomright"</span>,</span>
<span id="cb5-615"><a href="#cb5-615" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">paste0</span>(<span class="st">"AUC = "</span>, <span class="fu">round</span>(auc_svm, <span class="dv">3</span>)),</span>
<span id="cb5-616"><a href="#cb5-616" aria-hidden="true" tabindex="-1"></a>       <span class="at">bty    =</span> <span class="st">"n"</span>)</span>
<span id="cb5-617"><a href="#cb5-617" aria-hidden="true" tabindex="-1"></a>numeric_cols <span class="ot">&lt;-</span> trainData <span class="sc">%&gt;%</span> </span>
<span id="cb5-618"><a href="#cb5-618" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>default) <span class="sc">%&gt;%</span> </span>
<span id="cb5-619"><a href="#cb5-619" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">where</span>(is.numeric)) <span class="sc">%&gt;%</span> </span>
<span id="cb5-620"><a href="#cb5-620" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>()</span>
<span id="cb5-621"><a href="#cb5-621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-622"><a href="#cb5-622" aria-hidden="true" tabindex="-1"></a>maxs <span class="ot">&lt;-</span> <span class="fu">sapply</span>(trainData[numeric_cols], max)</span>
<span id="cb5-623"><a href="#cb5-623" aria-hidden="true" tabindex="-1"></a>mins <span class="ot">&lt;-</span> <span class="fu">sapply</span>(trainData[numeric_cols], min)</span>
<span id="cb5-624"><a href="#cb5-624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-625"><a href="#cb5-625" aria-hidden="true" tabindex="-1"></a>trainNN <span class="ot">&lt;-</span> trainData</span>
<span id="cb5-626"><a href="#cb5-626" aria-hidden="true" tabindex="-1"></a>testNN  <span class="ot">&lt;-</span> testData</span>
<span id="cb5-627"><a href="#cb5-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-628"><a href="#cb5-628" aria-hidden="true" tabindex="-1"></a>trainNN[numeric_cols] <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(</span>
<span id="cb5-629"><a href="#cb5-629" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale</span>(trainData[numeric_cols], <span class="at">center =</span> mins, <span class="at">scale =</span> maxs <span class="sc">-</span> mins)</span>
<span id="cb5-630"><a href="#cb5-630" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-631"><a href="#cb5-631" aria-hidden="true" tabindex="-1"></a>testNN[numeric_cols] <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(</span>
<span id="cb5-632"><a href="#cb5-632" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale</span>(testData[numeric_cols], <span class="at">center =</span> mins, <span class="at">scale =</span> maxs <span class="sc">-</span> mins)</span>
<span id="cb5-633"><a href="#cb5-633" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-634"><a href="#cb5-634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-635"><a href="#cb5-635" aria-hidden="true" tabindex="-1"></a>nn_model <span class="ot">&lt;-</span> <span class="fu">nnet</span>(default <span class="sc">~</span> ., <span class="at">data =</span> trainNN,</span>
<span id="cb5-636"><a href="#cb5-636" aria-hidden="true" tabindex="-1"></a>                 <span class="at">size =</span> <span class="dv">5</span>, <span class="at">decay =</span> <span class="fl">0.1</span>, <span class="at">maxit =</span> <span class="dv">500</span>, <span class="at">trace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb5-637"><a href="#cb5-637" aria-hidden="true" tabindex="-1"></a>nn_prob_raw <span class="ot">&lt;-</span> <span class="fu">predict</span>(nn_model, testNN, <span class="at">type =</span> <span class="st">"raw"</span>)</span>
<span id="cb5-638"><a href="#cb5-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-639"><a href="#cb5-639" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(nn_prob_raw)</span>
<span id="cb5-640"><a href="#cb5-640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-641"><a href="#cb5-641" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">is.matrix</span>(nn_prob_raw)) {</span>
<span id="cb5-642"><a href="#cb5-642" aria-hidden="true" tabindex="-1"></a>  <span class="co"># case A: named columns, e.g. c("No","Yes")</span></span>
<span id="cb5-643"><a href="#cb5-643" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="st">"Yes"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(nn_prob_raw)) {</span>
<span id="cb5-644"><a href="#cb5-644" aria-hidden="true" tabindex="-1"></a>    nn_prob <span class="ot">&lt;-</span> nn_prob_raw[, <span class="st">"Yes"</span>]</span>
<span id="cb5-645"><a href="#cb5-645" aria-hidden="true" tabindex="-1"></a>  <span class="co"># case B: two‐column unnamed matrix, assume column 2 = "Yes"</span></span>
<span id="cb5-646"><a href="#cb5-646" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">ncol</span>(nn_prob_raw) <span class="sc">==</span> <span class="dv">2</span>) {</span>
<span id="cb5-647"><a href="#cb5-647" aria-hidden="true" tabindex="-1"></a>    nn_prob <span class="ot">&lt;-</span> nn_prob_raw[, <span class="dv">2</span>]</span>
<span id="cb5-648"><a href="#cb5-648" aria-hidden="true" tabindex="-1"></a>  <span class="co"># case C: single‐column matrix, assume that column = "Yes"</span></span>
<span id="cb5-649"><a href="#cb5-649" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">ncol</span>(nn_prob_raw) <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb5-650"><a href="#cb5-650" aria-hidden="true" tabindex="-1"></a>    nn_prob <span class="ot">&lt;-</span> nn_prob_raw[, <span class="dv">1</span>]</span>
<span id="cb5-651"><a href="#cb5-651" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb5-652"><a href="#cb5-652" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"Unexpected number of columns in nn_prob_raw"</span>)</span>
<span id="cb5-653"><a href="#cb5-653" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-654"><a href="#cb5-654" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb5-655"><a href="#cb5-655" aria-hidden="true" tabindex="-1"></a>  <span class="co"># case D: a plain vector, treat it as the "Yes" probability</span></span>
<span id="cb5-656"><a href="#cb5-656" aria-hidden="true" tabindex="-1"></a>  nn_prob <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(nn_prob_raw)</span>
<span id="cb5-657"><a href="#cb5-657" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-658"><a href="#cb5-658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-659"><a href="#cb5-659" aria-hidden="true" tabindex="-1"></a><span class="co"># compute ROC/AUC</span></span>
<span id="cb5-660"><a href="#cb5-660" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pROC)</span>
<span id="cb5-661"><a href="#cb5-661" aria-hidden="true" tabindex="-1"></a>roc_nn <span class="ot">&lt;-</span> <span class="fu">roc</span>(<span class="at">response  =</span> testNN<span class="sc">$</span>default,</span>
<span id="cb5-662"><a href="#cb5-662" aria-hidden="true" tabindex="-1"></a>              <span class="at">predictor =</span> nn_prob,</span>
<span id="cb5-663"><a href="#cb5-663" aria-hidden="true" tabindex="-1"></a>              <span class="at">levels    =</span> <span class="fu">c</span>(<span class="st">"No"</span>,<span class="st">"Yes"</span>))</span>
<span id="cb5-664"><a href="#cb5-664" aria-hidden="true" tabindex="-1"></a>auc_nn <span class="ot">&lt;-</span> <span class="fu">auc</span>(roc_nn)</span>
<span id="cb5-665"><a href="#cb5-665" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Neural Net AUC = %.3f</span><span class="sc">\n</span><span class="st">"</span>, auc_nn))</span>
<span id="cb5-666"><a href="#cb5-666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-667"><a href="#cb5-667" aria-hidden="true" tabindex="-1"></a><span class="co"># compute F1‐score via confusionMatrix</span></span>
<span id="cb5-668"><a href="#cb5-668" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb5-669"><a href="#cb5-669" aria-hidden="true" tabindex="-1"></a>nn_pred <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">predict</span>(nn_model, testNN, <span class="at">type=</span><span class="st">"class"</span>),</span>
<span id="cb5-670"><a href="#cb5-670" aria-hidden="true" tabindex="-1"></a>                  <span class="at">levels =</span> <span class="fu">levels</span>(testNN<span class="sc">$</span>default))</span>
<span id="cb5-671"><a href="#cb5-671" aria-hidden="true" tabindex="-1"></a>cm_nn   <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(nn_pred, testNN<span class="sc">$</span>default, <span class="at">positive =</span> <span class="st">"Yes"</span>)</span>
<span id="cb5-672"><a href="#cb5-672" aria-hidden="true" tabindex="-1"></a>nn_counts <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(cm_nn<span class="sc">$</span>table) <span class="sc">%&gt;%</span></span>
<span id="cb5-673"><a href="#cb5-673" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb5-674"><a href="#cb5-674" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from  =</span> Reference,</span>
<span id="cb5-675"><a href="#cb5-675" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> Freq</span>
<span id="cb5-676"><a href="#cb5-676" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb5-677"><a href="#cb5-677" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Predicted =</span> Prediction)</span>
<span id="cb5-678"><a href="#cb5-678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-679"><a href="#cb5-679" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the key performance metrics</span></span>
<span id="cb5-680"><a href="#cb5-680" aria-hidden="true" tabindex="-1"></a>nn_stats <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb5-681"><a href="#cb5-681" aria-hidden="true" tabindex="-1"></a>  <span class="at">Metric =</span> <span class="fu">c</span>(</span>
<span id="cb5-682"><a href="#cb5-682" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Accuracy"</span>,</span>
<span id="cb5-683"><a href="#cb5-683" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Sensitivity (Recall)"</span>,</span>
<span id="cb5-684"><a href="#cb5-684" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Specificity"</span>,</span>
<span id="cb5-685"><a href="#cb5-685" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Precision (Pos Pred Value)"</span>,</span>
<span id="cb5-686"><a href="#cb5-686" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Negative Predictive Value"</span></span>
<span id="cb5-687"><a href="#cb5-687" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb5-688"><a href="#cb5-688" aria-hidden="true" tabindex="-1"></a>  <span class="at">Value =</span> <span class="fu">c</span>(</span>
<span id="cb5-689"><a href="#cb5-689" aria-hidden="true" tabindex="-1"></a>    cm_nn<span class="sc">$</span>overall[<span class="st">"Accuracy"</span>],</span>
<span id="cb5-690"><a href="#cb5-690" aria-hidden="true" tabindex="-1"></a>    cm_nn<span class="sc">$</span>byClass[<span class="st">"Sensitivity"</span>],</span>
<span id="cb5-691"><a href="#cb5-691" aria-hidden="true" tabindex="-1"></a>    cm_nn<span class="sc">$</span>byClass[<span class="st">"Specificity"</span>],</span>
<span id="cb5-692"><a href="#cb5-692" aria-hidden="true" tabindex="-1"></a>    cm_nn<span class="sc">$</span>byClass[<span class="st">"Pos Pred Value"</span>],</span>
<span id="cb5-693"><a href="#cb5-693" aria-hidden="true" tabindex="-1"></a>    cm_nn<span class="sc">$</span>byClass[<span class="st">"Neg Pred Value"</span>]</span>
<span id="cb5-694"><a href="#cb5-694" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-695"><a href="#cb5-695" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb5-696"><a href="#cb5-696" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Value =</span> <span class="fu">round</span>(Value, <span class="dv">3</span>))</span>
<span id="cb5-697"><a href="#cb5-697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-698"><a href="#cb5-698" aria-hidden="true" tabindex="-1"></a><span class="co"># Render both tables</span></span>
<span id="cb5-699"><a href="#cb5-699" aria-hidden="true" tabindex="-1"></a>nn_counts <span class="sc">%&gt;%</span></span>
<span id="cb5-700"><a href="#cb5-700" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(</span>
<span id="cb5-701"><a href="#cb5-701" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Table 17</span><span class="sc">\n</span><span class="st">Neural Network: Confusion Matrix Counts"</span>,</span>
<span id="cb5-702"><a href="#cb5-702" aria-hidden="true" tabindex="-1"></a>    <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Predicted </span><span class="sc">\\</span><span class="st"> Actual"</span>, <span class="st">"No"</span>, <span class="st">"Yes"</span>),</span>
<span id="cb5-703"><a href="#cb5-703" aria-hidden="true" tabindex="-1"></a>    <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"l"</span>, <span class="st">"r"</span>, <span class="st">"r"</span>)</span>
<span id="cb5-704"><a href="#cb5-704" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-705"><a href="#cb5-705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-706"><a href="#cb5-706" aria-hidden="true" tabindex="-1"></a>nn_stats <span class="sc">%&gt;%</span></span>
<span id="cb5-707"><a href="#cb5-707" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(</span>
<span id="cb5-708"><a href="#cb5-708" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Table 18</span><span class="sc">\n</span><span class="st">Neural Network: Performance Metrics"</span>,</span>
<span id="cb5-709"><a href="#cb5-709" aria-hidden="true" tabindex="-1"></a>    <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Metric"</span>, <span class="st">"Value"</span>),</span>
<span id="cb5-710"><a href="#cb5-710" aria-hidden="true" tabindex="-1"></a>    <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"l"</span>, <span class="st">"r"</span>)</span>
<span id="cb5-711"><a href="#cb5-711" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-712"><a href="#cb5-712" aria-hidden="true" tabindex="-1"></a>precision <span class="ot">&lt;-</span> cm_nn<span class="sc">$</span>byClass[<span class="st">"Pos Pred Value"</span>]</span>
<span id="cb5-713"><a href="#cb5-713" aria-hidden="true" tabindex="-1"></a>recall    <span class="ot">&lt;-</span> cm_nn<span class="sc">$</span>byClass[<span class="st">"Sensitivity"</span>]</span>
<span id="cb5-714"><a href="#cb5-714" aria-hidden="true" tabindex="-1"></a>f1        <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> (precision <span class="sc">*</span> recall) <span class="sc">/</span> (precision <span class="sc">+</span> recall)</span>
<span id="cb5-715"><a href="#cb5-715" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Neural Net F1‐score = %.3f</span><span class="sc">\n</span><span class="st">"</span>, f1))</span>
<span id="cb5-716"><a href="#cb5-716" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(roc_nn, <span class="at">main =</span> <span class="st">"Figure 11: ROC Curve: Neural Network"</span>, <span class="at">col=</span><span class="st">"darkred"</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb5-717"><a href="#cb5-717" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">lty=</span><span class="dv">2</span>, <span class="at">col=</span><span class="st">"gray"</span>)</span>
<span id="cb5-718"><a href="#cb5-718" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"bottomright"</span>,</span>
<span id="cb5-719"><a href="#cb5-719" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">paste0</span>(<span class="st">"AUC = "</span>, <span class="fu">round</span>(auc_nn, <span class="dv">3</span>)),</span>
<span id="cb5-720"><a href="#cb5-720" aria-hidden="true" tabindex="-1"></a>       <span class="at">bty    =</span> <span class="st">"n"</span>)</span>
<span id="cb5-721"><a href="#cb5-721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-722"><a href="#cb5-722" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare x/y matrices</span></span>
<span id="cb5-723"><a href="#cb5-723" aria-hidden="true" tabindex="-1"></a>x_train <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(default <span class="sc">~</span> . <span class="sc">-</span><span class="dv">1</span>, <span class="at">data =</span> trainData)</span>
<span id="cb5-724"><a href="#cb5-724" aria-hidden="true" tabindex="-1"></a>y_train <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(trainData<span class="sc">$</span>default <span class="sc">==</span> <span class="st">"Yes"</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb5-725"><a href="#cb5-725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-726"><a href="#cb5-726" aria-hidden="true" tabindex="-1"></a>x_test  <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(default <span class="sc">~</span> . <span class="sc">-</span><span class="dv">1</span>, <span class="at">data =</span> testData)</span>
<span id="cb5-727"><a href="#cb5-727" aria-hidden="true" tabindex="-1"></a>y_test  <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(testData<span class="sc">$</span>default <span class="sc">==</span> <span class="st">"Yes"</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb5-728"><a href="#cb5-728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-729"><a href="#cb5-729" aria-hidden="true" tabindex="-1"></a><span class="co"># Cross‐validated LASSO (alpha = 1)</span></span>
<span id="cb5-730"><a href="#cb5-730" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2025</span>)</span>
<span id="cb5-731"><a href="#cb5-731" aria-hidden="true" tabindex="-1"></a>cv_lasso <span class="ot">&lt;-</span> <span class="fu">cv.glmnet</span>(</span>
<span id="cb5-732"><a href="#cb5-732" aria-hidden="true" tabindex="-1"></a>  x_train, y_train,</span>
<span id="cb5-733"><a href="#cb5-733" aria-hidden="true" tabindex="-1"></a>  <span class="at">family    =</span> <span class="st">"binomial"</span>,</span>
<span id="cb5-734"><a href="#cb5-734" aria-hidden="true" tabindex="-1"></a>  <span class="at">alpha     =</span> <span class="dv">1</span>,</span>
<span id="cb5-735"><a href="#cb5-735" aria-hidden="true" tabindex="-1"></a>  <span class="at">nfolds    =</span> <span class="dv">5</span>,</span>
<span id="cb5-736"><a href="#cb5-736" aria-hidden="true" tabindex="-1"></a>  <span class="at">type.measure =</span> <span class="st">"auc"</span></span>
<span id="cb5-737"><a href="#cb5-737" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-738"><a href="#cb5-738" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-739"><a href="#cb5-739" aria-hidden="true" tabindex="-1"></a><span class="co"># Optimal λ</span></span>
<span id="cb5-740"><a href="#cb5-740" aria-hidden="true" tabindex="-1"></a>lambda_lasso <span class="ot">&lt;-</span> cv_lasso<span class="sc">$</span>lambda.min</span>
<span id="cb5-741"><a href="#cb5-741" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"LASSO λ_min ="</span>, <span class="fu">round</span>(lambda_lasso, <span class="dv">5</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb5-742"><a href="#cb5-742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-743"><a href="#cb5-743" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract LASSO coefficients at λ_min</span></span>
<span id="cb5-744"><a href="#cb5-744" aria-hidden="true" tabindex="-1"></a>coef_lasso <span class="ot">&lt;-</span> <span class="fu">coef</span>(cv_lasso, <span class="at">s =</span> <span class="st">"lambda.min"</span>)</span>
<span id="cb5-745"><a href="#cb5-745" aria-hidden="true" tabindex="-1"></a><span class="co"># Turn into a tibble</span></span>
<span id="cb5-746"><a href="#cb5-746" aria-hidden="true" tabindex="-1"></a>lasso_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb5-747"><a href="#cb5-747" aria-hidden="true" tabindex="-1"></a>  <span class="at">Feature =</span> <span class="fu">rownames</span>(coef_lasso),</span>
<span id="cb5-748"><a href="#cb5-748" aria-hidden="true" tabindex="-1"></a>  <span class="at">Coefficient =</span> <span class="fu">as.numeric</span>(coef_lasso)</span>
<span id="cb5-749"><a href="#cb5-749" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb5-750"><a href="#cb5-750" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Feature <span class="sc">!=</span> <span class="st">"(Intercept)"</span>)</span>
<span id="cb5-751"><a href="#cb5-751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-752"><a href="#cb5-752" aria-hidden="true" tabindex="-1"></a><span class="co"># Count non‐zero</span></span>
<span id="cb5-753"><a href="#cb5-753" aria-hidden="true" tabindex="-1"></a>n_nonzero <span class="ot">&lt;-</span> <span class="fu">sum</span>(lasso_df<span class="sc">$</span>Coefficient <span class="sc">!=</span> <span class="dv">0</span>)</span>
<span id="cb5-754"><a href="#cb5-754" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Number of non‐zero features (excluding intercept):"</span>, n_nonzero, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb5-755"><a href="#cb5-755" aria-hidden="true" tabindex="-1"></a>cvdf <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb5-756"><a href="#cb5-756" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lambda =</span> <span class="fu">log</span>(cv_lasso<span class="sc">$</span>lambda),</span>
<span id="cb5-757"><a href="#cb5-757" aria-hidden="true" tabindex="-1"></a>  <span class="at">auc        =</span> cv_lasso<span class="sc">$</span>cvm,</span>
<span id="cb5-758"><a href="#cb5-758" aria-hidden="true" tabindex="-1"></a>  <span class="at">se         =</span> cv_lasso<span class="sc">$</span>cvsd</span>
<span id="cb5-759"><a href="#cb5-759" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-760"><a href="#cb5-760" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-761"><a href="#cb5-761" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cvdf, <span class="fu">aes</span>(<span class="at">x =</span> log_lambda, <span class="at">y =</span> auc)) <span class="sc">+</span></span>
<span id="cb5-762"><a href="#cb5-762" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"#2c7fb8"</span>) <span class="sc">+</span></span>
<span id="cb5-763"><a href="#cb5-763" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"#2c7fb8"</span>) <span class="sc">+</span></span>
<span id="cb5-764"><a href="#cb5-764" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> auc <span class="sc">-</span> se, <span class="at">ymax =</span> auc <span class="sc">+</span> se),</span>
<span id="cb5-765"><a href="#cb5-765" aria-hidden="true" tabindex="-1"></a>                <span class="at">width =</span> <span class="fl">0.1</span>, <span class="at">color =</span> <span class="st">"gray50"</span>) <span class="sc">+</span></span>
<span id="cb5-766"><a href="#cb5-766" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">log</span>(lambda_lasso),</span>
<span id="cb5-767"><a href="#cb5-767" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"#e34a33"</span>, <span class="at">linewidth =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb5-768"><a href="#cb5-768" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>,</span>
<span id="cb5-769"><a href="#cb5-769" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="fu">log</span>(lambda_lasso),</span>
<span id="cb5-770"><a href="#cb5-770" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="fu">max</span>(cvdf<span class="sc">$</span>auc),</span>
<span id="cb5-771"><a href="#cb5-771" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">sprintf</span>(<span class="st">"λₘᵢₙ = %.2e"</span>, lambda_lasso),</span>
<span id="cb5-772"><a href="#cb5-772" aria-hidden="true" tabindex="-1"></a>           <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb5-773"><a href="#cb5-773" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">"#e34a33"</span>) <span class="sc">+</span></span>
<span id="cb5-774"><a href="#cb5-774" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">pretty</span>(cvdf<span class="sc">$</span>log_lambda, <span class="dv">8</span>)) <span class="sc">+</span></span>
<span id="cb5-775"><a href="#cb5-775" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb5-776"><a href="#cb5-776" aria-hidden="true" tabindex="-1"></a>    <span class="at">title    =</span> <span class="st">"Figure 12: LASSO 5-Fold CV AUC vs. log(λ)"</span>,</span>
<span id="cb5-777"><a href="#cb5-777" aria-hidden="true" tabindex="-1"></a>    <span class="at">x        =</span> <span class="fu">expression</span>(<span class="fu">log</span>(lambda)),</span>
<span id="cb5-778"><a href="#cb5-778" aria-hidden="true" tabindex="-1"></a>    <span class="at">y        =</span> <span class="st">"Cross-Validated AUC"</span></span>
<span id="cb5-779"><a href="#cb5-779" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb5-780"><a href="#cb5-780" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>)</span>
<span id="cb5-781"><a href="#cb5-781" aria-hidden="true" tabindex="-1"></a>lasso_df <span class="sc">%&gt;%</span></span>
<span id="cb5-782"><a href="#cb5-782" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Coefficient <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-783"><a href="#cb5-783" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="fu">abs</span>(Coefficient))) <span class="sc">%&gt;%</span></span>
<span id="cb5-784"><a href="#cb5-784" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">n =</span> <span class="cn">Inf</span>)</span>
<span id="cb5-785"><a href="#cb5-785" aria-hidden="true" tabindex="-1"></a>cv_ridge <span class="ot">&lt;-</span> <span class="fu">cv.glmnet</span>(</span>
<span id="cb5-786"><a href="#cb5-786" aria-hidden="true" tabindex="-1"></a>  x_train, y_train,</span>
<span id="cb5-787"><a href="#cb5-787" aria-hidden="true" tabindex="-1"></a>  <span class="at">family    =</span> <span class="st">"binomial"</span>,</span>
<span id="cb5-788"><a href="#cb5-788" aria-hidden="true" tabindex="-1"></a>  <span class="at">alpha     =</span> <span class="dv">0</span>,</span>
<span id="cb5-789"><a href="#cb5-789" aria-hidden="true" tabindex="-1"></a>  <span class="at">nfolds    =</span> <span class="dv">5</span>,</span>
<span id="cb5-790"><a href="#cb5-790" aria-hidden="true" tabindex="-1"></a>  <span class="at">type.measure =</span> <span class="st">"auc"</span></span>
<span id="cb5-791"><a href="#cb5-791" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-792"><a href="#cb5-792" aria-hidden="true" tabindex="-1"></a>lambda_ridge <span class="ot">&lt;-</span> cv_ridge<span class="sc">$</span>lambda.min</span>
<span id="cb5-793"><a href="#cb5-793" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Ridge λ_min ="</span>, <span class="fu">round</span>(lambda_ridge, <span class="dv">5</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb5-794"><a href="#cb5-794" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-795"><a href="#cb5-795" aria-hidden="true" tabindex="-1"></a>coef_ridge <span class="ot">&lt;-</span> <span class="fu">coef</span>(cv_ridge, <span class="at">s =</span> <span class="st">"lambda.min"</span>)</span>
<span id="cb5-796"><a href="#cb5-796" aria-hidden="true" tabindex="-1"></a>ridge_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb5-797"><a href="#cb5-797" aria-hidden="true" tabindex="-1"></a>  <span class="at">Feature =</span> <span class="fu">rownames</span>(coef_ridge),</span>
<span id="cb5-798"><a href="#cb5-798" aria-hidden="true" tabindex="-1"></a>  <span class="at">Coefficient =</span> <span class="fu">as.numeric</span>(coef_ridge)</span>
<span id="cb5-799"><a href="#cb5-799" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb5-800"><a href="#cb5-800" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Feature <span class="sc">!=</span> <span class="st">"(Intercept)"</span>)</span>
<span id="cb5-801"><a href="#cb5-801" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-802"><a href="#cb5-802" aria-hidden="true" tabindex="-1"></a><span class="co"># LASSO predictions</span></span>
<span id="cb5-803"><a href="#cb5-803" aria-hidden="true" tabindex="-1"></a>pred_lasso_prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(cv_lasso, <span class="at">newx =</span> x_test, <span class="at">s =</span> <span class="st">"lambda.min"</span>, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb5-804"><a href="#cb5-804" aria-hidden="true" tabindex="-1"></a>roc_lasso       <span class="ot">&lt;-</span> <span class="fu">roc</span>(y_test, <span class="fu">as.vector</span>(pred_lasso_prob))</span>
<span id="cb5-805"><a href="#cb5-805" aria-hidden="true" tabindex="-1"></a>auc_lasso       <span class="ot">&lt;-</span> <span class="fu">auc</span>(roc_lasso)</span>
<span id="cb5-806"><a href="#cb5-806" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-807"><a href="#cb5-807" aria-hidden="true" tabindex="-1"></a>full_logistic <span class="ot">&lt;-</span> <span class="fu">glm</span>(default <span class="sc">~</span> ., <span class="at">data =</span> trainData, <span class="at">family =</span> binomial)</span>
<span id="cb5-808"><a href="#cb5-808" aria-hidden="true" tabindex="-1"></a>pred_full     <span class="ot">&lt;-</span> <span class="fu">predict</span>(full_logistic, <span class="at">newdata =</span> testData, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb5-809"><a href="#cb5-809" aria-hidden="true" tabindex="-1"></a>roc_full      <span class="ot">&lt;-</span> <span class="fu">roc</span>(y_test, pred_full)</span>
<span id="cb5-810"><a href="#cb5-810" aria-hidden="true" tabindex="-1"></a>auc_full      <span class="ot">&lt;-</span> <span class="fu">auc</span>(roc_full)</span>
<span id="cb5-811"><a href="#cb5-811" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-812"><a href="#cb5-812" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"AUC (LASSO) = %.3f; AUC (full logit) = %.3f</span><span class="sc">\n</span><span class="st">"</span>, auc_lasso, auc_full))</span>
<span id="cb5-813"><a href="#cb5-813" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) Logistic Regression</span></span>
<span id="cb5-814"><a href="#cb5-814" aria-hidden="true" tabindex="-1"></a>logit_prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(logit_model, <span class="at">newdata =</span> testData, <span class="at">type =</span> <span class="st">"prob"</span>)[, <span class="st">"Yes"</span>]</span>
<span id="cb5-815"><a href="#cb5-815" aria-hidden="true" tabindex="-1"></a>logit_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(logit_model, <span class="at">newdata =</span> testData)  </span>
<span id="cb5-816"><a href="#cb5-816" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-817"><a href="#cb5-817" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) Decision Tree (rpart)</span></span>
<span id="cb5-818"><a href="#cb5-818" aria-hidden="true" tabindex="-1"></a>tree_prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(tree_model,   <span class="at">newdata =</span> testData, <span class="at">type =</span> <span class="st">"prob"</span>)[, <span class="st">"Yes"</span>]</span>
<span id="cb5-819"><a href="#cb5-819" aria-hidden="true" tabindex="-1"></a>tree_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(tree_model,   <span class="at">newdata =</span> testData, <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb5-820"><a href="#cb5-820" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-821"><a href="#cb5-821" aria-hidden="true" tabindex="-1"></a><span class="co"># 3) Random Forest</span></span>
<span id="cb5-822"><a href="#cb5-822" aria-hidden="true" tabindex="-1"></a>rf_prob   <span class="ot">&lt;-</span> <span class="fu">predict</span>(rf_model,     <span class="at">newdata =</span> testData, <span class="at">type =</span> <span class="st">"prob"</span>)[, <span class="st">"Yes"</span>]</span>
<span id="cb5-823"><a href="#cb5-823" aria-hidden="true" tabindex="-1"></a>rf_pred   <span class="ot">&lt;-</span> <span class="fu">predict</span>(rf_model,     <span class="at">newdata =</span> testData)</span>
<span id="cb5-824"><a href="#cb5-824" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-825"><a href="#cb5-825" aria-hidden="true" tabindex="-1"></a><span class="co"># 4) XGBoost</span></span>
<span id="cb5-826"><a href="#cb5-826" aria-hidden="true" tabindex="-1"></a>xgb_prob  <span class="ot">&lt;-</span> <span class="fu">predict</span>(xgb_model,    <span class="at">newdata =</span> test_matrix)      <span class="co"># this is already a numeric vector</span></span>
<span id="cb5-827"><a href="#cb5-827" aria-hidden="true" tabindex="-1"></a>xgb_pred  <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">ifelse</span>(xgb_prob <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="st">"Yes"</span>, <span class="st">"No"</span>),</span>
<span id="cb5-828"><a href="#cb5-828" aria-hidden="true" tabindex="-1"></a>                    <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"No"</span>,<span class="st">"Yes"</span>))</span>
<span id="cb5-829"><a href="#cb5-829" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-830"><a href="#cb5-830" aria-hidden="true" tabindex="-1"></a><span class="co"># 5) SVM</span></span>
<span id="cb5-831"><a href="#cb5-831" aria-hidden="true" tabindex="-1"></a>svm_prob  <span class="ot">&lt;-</span> <span class="fu">attr</span>(<span class="fu">predict</span>(svm_model, <span class="at">newdata =</span> testData, <span class="at">probability=</span><span class="cn">TRUE</span>),</span>
<span id="cb5-832"><a href="#cb5-832" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"probabilities"</span>)[, <span class="st">"Yes"</span>]</span>
<span id="cb5-833"><a href="#cb5-833" aria-hidden="true" tabindex="-1"></a>svm_pred  <span class="ot">&lt;-</span> <span class="fu">predict</span>(svm_model,     <span class="at">newdata =</span> testData)</span>
<span id="cb5-834"><a href="#cb5-834" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-835"><a href="#cb5-835" aria-hidden="true" tabindex="-1"></a><span class="co"># 6) Neural Net</span></span>
<span id="cb5-836"><a href="#cb5-836" aria-hidden="true" tabindex="-1"></a>nn_pred   <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">predict</span>(nn_model,    <span class="at">newdata =</span> testNN, <span class="at">type=</span><span class="st">"class"</span>),</span>
<span id="cb5-837"><a href="#cb5-837" aria-hidden="true" tabindex="-1"></a>                    <span class="at">levels =</span> <span class="fu">levels</span>(testNN<span class="sc">$</span>default))</span>
<span id="cb5-838"><a href="#cb5-838" aria-hidden="true" tabindex="-1"></a>nn_raw    <span class="ot">&lt;-</span> <span class="fu">predict</span>(nn_model,            <span class="at">newdata =</span> testNN, <span class="at">type=</span><span class="st">"raw"</span>)</span>
<span id="cb5-839"><a href="#cb5-839" aria-hidden="true" tabindex="-1"></a>nn_prob   <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">is.matrix</span>(nn_raw)) nn_raw[,<span class="dv">1</span>] <span class="cf">else</span> <span class="fu">as.numeric</span>(nn_raw)</span>
<span id="cb5-840"><a href="#cb5-840" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-841"><a href="#cb5-841" aria-hidden="true" tabindex="-1"></a><span class="co"># 7) LASSO‐Logistic</span></span>
<span id="cb5-842"><a href="#cb5-842" aria-hidden="true" tabindex="-1"></a>lasso_prob <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">predict</span>(cv_lasso, <span class="at">newx =</span> x_test, <span class="at">s=</span><span class="st">"lambda.min"</span>, <span class="at">type=</span><span class="st">"response"</span>))</span>
<span id="cb5-843"><a href="#cb5-843" aria-hidden="true" tabindex="-1"></a>lasso_pred <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">ifelse</span>(lasso_prob <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="st">"Yes"</span>, <span class="st">"No"</span>),</span>
<span id="cb5-844"><a href="#cb5-844" aria-hidden="true" tabindex="-1"></a>                     <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"No"</span>,<span class="st">"Yes"</span>))</span>
<span id="cb5-845"><a href="#cb5-845" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-846"><a href="#cb5-846" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-847"><a href="#cb5-847" aria-hidden="true" tabindex="-1"></a>models <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb5-848"><a href="#cb5-848" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Logistic Regression"</span> <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb5-849"><a href="#cb5-849" aria-hidden="true" tabindex="-1"></a>     <span class="at">pred_class =</span> logit_pred,</span>
<span id="cb5-850"><a href="#cb5-850" aria-hidden="true" tabindex="-1"></a>     <span class="at">pred_prob  =</span> logit_prob</span>
<span id="cb5-851"><a href="#cb5-851" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb5-852"><a href="#cb5-852" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Decision Tree (CART)"</span> <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb5-853"><a href="#cb5-853" aria-hidden="true" tabindex="-1"></a>     <span class="at">pred_class =</span> tree_pred,</span>
<span id="cb5-854"><a href="#cb5-854" aria-hidden="true" tabindex="-1"></a>     <span class="at">pred_prob  =</span> tree_prob</span>
<span id="cb5-855"><a href="#cb5-855" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb5-856"><a href="#cb5-856" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Random Forest"</span> <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb5-857"><a href="#cb5-857" aria-hidden="true" tabindex="-1"></a>     <span class="at">pred_class =</span> rf_pred,</span>
<span id="cb5-858"><a href="#cb5-858" aria-hidden="true" tabindex="-1"></a>     <span class="at">pred_prob  =</span> rf_prob</span>
<span id="cb5-859"><a href="#cb5-859" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb5-860"><a href="#cb5-860" aria-hidden="true" tabindex="-1"></a>  <span class="st">"XGBoost"</span> <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb5-861"><a href="#cb5-861" aria-hidden="true" tabindex="-1"></a>     <span class="at">pred_class =</span> xgb_pred,</span>
<span id="cb5-862"><a href="#cb5-862" aria-hidden="true" tabindex="-1"></a>     <span class="at">pred_prob  =</span> xgb_prob   <span class="co"># no “_prob” vs “_pred_prob” mismatch</span></span>
<span id="cb5-863"><a href="#cb5-863" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb5-864"><a href="#cb5-864" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SVM (RBF Kernel)"</span> <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb5-865"><a href="#cb5-865" aria-hidden="true" tabindex="-1"></a>     <span class="at">pred_class =</span> svm_pred,</span>
<span id="cb5-866"><a href="#cb5-866" aria-hidden="true" tabindex="-1"></a>     <span class="at">pred_prob  =</span> svm_prob</span>
<span id="cb5-867"><a href="#cb5-867" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb5-868"><a href="#cb5-868" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Neural Network (1 layer)"</span> <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb5-869"><a href="#cb5-869" aria-hidden="true" tabindex="-1"></a>     <span class="at">pred_class =</span> nn_pred,</span>
<span id="cb5-870"><a href="#cb5-870" aria-hidden="true" tabindex="-1"></a>     <span class="at">pred_prob  =</span> nn_prob</span>
<span id="cb5-871"><a href="#cb5-871" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb5-872"><a href="#cb5-872" aria-hidden="true" tabindex="-1"></a>  <span class="st">"LASSO–Logistic"</span> <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb5-873"><a href="#cb5-873" aria-hidden="true" tabindex="-1"></a>     <span class="at">pred_class =</span> lasso_pred,</span>
<span id="cb5-874"><a href="#cb5-874" aria-hidden="true" tabindex="-1"></a>     <span class="at">pred_prob  =</span> lasso_prob</span>
<span id="cb5-875"><a href="#cb5-875" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-876"><a href="#cb5-876" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-877"><a href="#cb5-877" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-878"><a href="#cb5-878" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a helper to compute metrics for one model</span></span>
<span id="cb5-879"><a href="#cb5-879" aria-hidden="true" tabindex="-1"></a>get_metrics <span class="ot">&lt;-</span> <span class="cf">function</span>(name, pred_class, pred_prob, truth) {</span>
<span id="cb5-880"><a href="#cb5-880" aria-hidden="true" tabindex="-1"></a>  cm  <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(</span>
<span id="cb5-881"><a href="#cb5-881" aria-hidden="true" tabindex="-1"></a>           <span class="fu">factor</span>(pred_class, <span class="at">levels=</span><span class="fu">levels</span>(truth)),</span>
<span id="cb5-882"><a href="#cb5-882" aria-hidden="true" tabindex="-1"></a>           truth,</span>
<span id="cb5-883"><a href="#cb5-883" aria-hidden="true" tabindex="-1"></a>           <span class="at">positive =</span> <span class="st">"Yes"</span></span>
<span id="cb5-884"><a href="#cb5-884" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb5-885"><a href="#cb5-885" aria-hidden="true" tabindex="-1"></a>  roc_obj <span class="ot">&lt;-</span> <span class="fu">roc</span>(<span class="at">response =</span> truth,</span>
<span id="cb5-886"><a href="#cb5-886" aria-hidden="true" tabindex="-1"></a>                 <span class="at">predictor =</span> pred_prob,</span>
<span id="cb5-887"><a href="#cb5-887" aria-hidden="true" tabindex="-1"></a>                 <span class="at">levels    =</span> <span class="fu">c</span>(<span class="st">"No"</span>,<span class="st">"Yes"</span>))</span>
<span id="cb5-888"><a href="#cb5-888" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb5-889"><a href="#cb5-889" aria-hidden="true" tabindex="-1"></a>    <span class="at">Model    =</span> name,</span>
<span id="cb5-890"><a href="#cb5-890" aria-hidden="true" tabindex="-1"></a>    <span class="at">Accuracy =</span> cm<span class="sc">$</span>overall[<span class="st">"Accuracy"</span>],</span>
<span id="cb5-891"><a href="#cb5-891" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">ROC AUC</span><span class="st">`</span><span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="fu">auc</span>(roc_obj)),</span>
<span id="cb5-892"><a href="#cb5-892" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Default Recall (Sensitivity)</span><span class="st">`</span> <span class="ot">=</span> cm<span class="sc">$</span>byClass[<span class="st">"Sensitivity"</span>],</span>
<span id="cb5-893"><a href="#cb5-893" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Default Precision (PPV)</span><span class="st">`</span>      <span class="ot">=</span> cm<span class="sc">$</span>byClass[<span class="st">"Pos Pred Value"</span>]</span>
<span id="cb5-894"><a href="#cb5-894" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-895"><a href="#cb5-895" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-896"><a href="#cb5-896" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-897"><a href="#cb5-897" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over our models list and bind into one data frame</span></span>
<span id="cb5-898"><a href="#cb5-898" aria-hidden="true" tabindex="-1"></a>performance <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb5-899"><a href="#cb5-899" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lapply</span>(<span class="fu">names</span>(models), <span class="cf">function</span>(m) {</span>
<span id="cb5-900"><a href="#cb5-900" aria-hidden="true" tabindex="-1"></a>    <span class="fu">get_metrics</span>(</span>
<span id="cb5-901"><a href="#cb5-901" aria-hidden="true" tabindex="-1"></a>      <span class="at">name       =</span> m,</span>
<span id="cb5-902"><a href="#cb5-902" aria-hidden="true" tabindex="-1"></a>      <span class="at">pred_class =</span> models[[m]]<span class="sc">$</span>pred_class,</span>
<span id="cb5-903"><a href="#cb5-903" aria-hidden="true" tabindex="-1"></a>      <span class="at">pred_prob  =</span> models[[m]]<span class="sc">$</span>pred_prob,</span>
<span id="cb5-904"><a href="#cb5-904" aria-hidden="true" tabindex="-1"></a>      <span class="at">truth      =</span> testData<span class="sc">$</span>default   <span class="co"># or testNN$default for NN</span></span>
<span id="cb5-905"><a href="#cb5-905" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-906"><a href="#cb5-906" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb5-907"><a href="#cb5-907" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb5-908"><a href="#cb5-908" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb5-909"><a href="#cb5-909" aria-hidden="true" tabindex="-1"></a>    <span class="at">Accuracy                        =</span> <span class="fu">percent</span>(Accuracy, <span class="at">accuracy =</span> <span class="fl">0.1</span>),</span>
<span id="cb5-910"><a href="#cb5-910" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Default Recall (Sensitivity)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">percent</span>(<span class="st">`</span><span class="at">Default Recall (Sensitivity)</span><span class="st">`</span>, <span class="at">accuracy =</span> <span class="dv">1</span>),</span>
<span id="cb5-911"><a href="#cb5-911" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Default Precision (PPV)</span><span class="st">`</span>      <span class="ot">=</span> <span class="fu">percent</span>(<span class="st">`</span><span class="at">Default Precision (PPV)</span><span class="st">`</span>, <span class="at">accuracy =</span> <span class="dv">1</span>),</span>
<span id="cb5-912"><a href="#cb5-912" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">ROC AUC</span><span class="st">`</span>                      <span class="ot">=</span> <span class="fu">round</span>(<span class="st">`</span><span class="at">ROC AUC</span><span class="st">`</span>, <span class="dv">2</span>)</span>
<span id="cb5-913"><a href="#cb5-913" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-914"><a href="#cb5-914" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(</span>
<span id="cb5-915"><a href="#cb5-915" aria-hidden="true" tabindex="-1"></a>  performance,</span>
<span id="cb5-916"><a href="#cb5-916" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Table 19</span><span class="sc">\n</span><span class="st">Model comparison on the 20% test set: accuracy, ROC AUC, and default‐class recall &amp; precision."</span>,</span>
<span id="cb5-917"><a href="#cb5-917" aria-hidden="true" tabindex="-1"></a>  <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb5-918"><a href="#cb5-918" aria-hidden="true" tabindex="-1"></a>  <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"l"</span>,<span class="st">"c"</span>,<span class="st">"c"</span>,<span class="st">"c"</span>,<span class="st">"c"</span>)</span>
<span id="cb5-919"><a href="#cb5-919" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-920"><a href="#cb5-920" aria-hidden="true" tabindex="-1"></a>table1 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb5-921"><a href="#cb5-921" aria-hidden="true" tabindex="-1"></a>  <span class="at">Predictor =</span> <span class="fu">c</span>(</span>
<span id="cb5-922"><a href="#cb5-922" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Repayment status PAY_0–PAY_6"</span>,</span>
<span id="cb5-923"><a href="#cb5-923" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Credit limit (LIMIT_BAL)"</span>,</span>
<span id="cb5-924"><a href="#cb5-924" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Education level"</span>,</span>
<span id="cb5-925"><a href="#cb5-925" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Marital status (Married vs Single)"</span>,</span>
<span id="cb5-926"><a href="#cb5-926" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Age"</span>,</span>
<span id="cb5-927"><a href="#cb5-927" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Bill/Pymt amounts (BILL_AMT, PAY_AMT)"</span></span>
<span id="cb5-928"><a href="#cb5-928" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb5-929"><a href="#cb5-929" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Effect on Default Risk</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(</span>
<span id="cb5-930"><a href="#cb5-930" aria-hidden="true" tabindex="-1"></a>    <span class="st">"**Positive** (+): recent late payments greatly increase risk"</span>,</span>
<span id="cb5-931"><a href="#cb5-931" aria-hidden="true" tabindex="-1"></a>    <span class="st">"**Negative** (–): higher limit slightly lowers risk"</span>,</span>
<span id="cb5-932"><a href="#cb5-932" aria-hidden="true" tabindex="-1"></a>    <span class="st">"**Negative** (–): higher education associated with lower risk"</span>,</span>
<span id="cb5-933"><a href="#cb5-933" aria-hidden="true" tabindex="-1"></a>    <span class="st">"**Negative** (–): being married has a minor protective effect"</span>,</span>
<span id="cb5-934"><a href="#cb5-934" aria-hidden="true" tabindex="-1"></a>    <span class="st">"**Negative** (–): older age slightly reduces risk"</span>,</span>
<span id="cb5-935"><a href="#cb5-935" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Mixed/Neutral: little net effect once payment status is known"</span></span>
<span id="cb5-936"><a href="#cb5-936" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-937"><a href="#cb5-937" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-938"><a href="#cb5-938" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-939"><a href="#cb5-939" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(</span>
<span id="cb5-940"><a href="#cb5-940" aria-hidden="true" tabindex="-1"></a>  table1,</span>
<span id="cb5-941"><a href="#cb5-941" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Table 20: Predictor effects on default risk. Positive (+) means higher values increase default risk; negative (–) means higher values decrease risk."</span></span>
<span id="cb5-942"><a href="#cb5-942" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-943"><a href="#cb5-943" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Compute mean bill and payment amounts from the training data</span></span>
<span id="cb5-944"><a href="#cb5-944" aria-hidden="true" tabindex="-1"></a>amt_means <span class="ot">&lt;-</span> trainData <span class="sc">%&gt;%</span></span>
<span id="cb5-945"><a href="#cb5-945" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb5-946"><a href="#cb5-946" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_BILL_AMT1 =</span> <span class="fu">mean</span>(BILL_AMT1),</span>
<span id="cb5-947"><a href="#cb5-947" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_BILL_AMT2 =</span> <span class="fu">mean</span>(BILL_AMT2),</span>
<span id="cb5-948"><a href="#cb5-948" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_BILL_AMT3 =</span> <span class="fu">mean</span>(BILL_AMT3),</span>
<span id="cb5-949"><a href="#cb5-949" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_BILL_AMT4 =</span> <span class="fu">mean</span>(BILL_AMT4),</span>
<span id="cb5-950"><a href="#cb5-950" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_BILL_AMT5 =</span> <span class="fu">mean</span>(BILL_AMT5),</span>
<span id="cb5-951"><a href="#cb5-951" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_BILL_AMT6 =</span> <span class="fu">mean</span>(BILL_AMT6),</span>
<span id="cb5-952"><a href="#cb5-952" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_PAY_AMT1  =</span> <span class="fu">mean</span>(PAY_AMT1),</span>
<span id="cb5-953"><a href="#cb5-953" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_PAY_AMT2  =</span> <span class="fu">mean</span>(PAY_AMT2),</span>
<span id="cb5-954"><a href="#cb5-954" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_PAY_AMT3  =</span> <span class="fu">mean</span>(PAY_AMT3),</span>
<span id="cb5-955"><a href="#cb5-955" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_PAY_AMT4  =</span> <span class="fu">mean</span>(PAY_AMT4),</span>
<span id="cb5-956"><a href="#cb5-956" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_PAY_AMT5  =</span> <span class="fu">mean</span>(PAY_AMT5),</span>
<span id="cb5-957"><a href="#cb5-957" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_PAY_AMT6  =</span> <span class="fu">mean</span>(PAY_AMT6)</span>
<span id="cb5-958"><a href="#cb5-958" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-959"><a href="#cb5-959" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-960"><a href="#cb5-960" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Create the new-customer tibble</span></span>
<span id="cb5-961"><a href="#cb5-961" aria-hidden="true" tabindex="-1"></a>new_customer <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb5-962"><a href="#cb5-962" aria-hidden="true" tabindex="-1"></a>  <span class="at">AGE       =</span> <span class="dv">30</span>,</span>
<span id="cb5-963"><a href="#cb5-963" aria-hidden="true" tabindex="-1"></a>  <span class="at">SEX       =</span> <span class="fu">factor</span>(<span class="st">"Male"</span>,   <span class="at">levels =</span> <span class="fu">levels</span>(trainData<span class="sc">$</span>SEX)),</span>
<span id="cb5-964"><a href="#cb5-964" aria-hidden="true" tabindex="-1"></a>  <span class="at">EDUCATION =</span> <span class="fu">factor</span>(<span class="st">"University"</span>, <span class="at">levels =</span> <span class="fu">levels</span>(trainData<span class="sc">$</span>EDUCATION)),</span>
<span id="cb5-965"><a href="#cb5-965" aria-hidden="true" tabindex="-1"></a>  <span class="at">MARRIAGE  =</span> <span class="fu">factor</span>(<span class="st">"Single"</span>,     <span class="at">levels =</span> <span class="fu">levels</span>(trainData<span class="sc">$</span>MARRIAGE)),</span>
<span id="cb5-966"><a href="#cb5-966" aria-hidden="true" tabindex="-1"></a>  <span class="at">LIMIT_BAL =</span> <span class="dv">50000</span>,</span>
<span id="cb5-967"><a href="#cb5-967" aria-hidden="true" tabindex="-1"></a>  <span class="at">PAY_0 =</span> <span class="dv">1</span>,</span>
<span id="cb5-968"><a href="#cb5-968" aria-hidden="true" tabindex="-1"></a>  <span class="at">PAY_2 =</span> <span class="dv">0</span>, <span class="at">PAY_3 =</span> <span class="dv">0</span>, <span class="at">PAY_4 =</span> <span class="dv">0</span>, <span class="at">PAY_5 =</span> <span class="dv">0</span>, <span class="at">PAY_6 =</span> <span class="dv">0</span>,</span>
<span id="cb5-969"><a href="#cb5-969" aria-hidden="true" tabindex="-1"></a>  <span class="at">BILL_AMT1 =</span> amt_means<span class="sc">$</span>mean_BILL_AMT1,</span>
<span id="cb5-970"><a href="#cb5-970" aria-hidden="true" tabindex="-1"></a>  <span class="at">BILL_AMT2 =</span> amt_means<span class="sc">$</span>mean_BILL_AMT2,</span>
<span id="cb5-971"><a href="#cb5-971" aria-hidden="true" tabindex="-1"></a>  <span class="at">BILL_AMT3 =</span> amt_means<span class="sc">$</span>mean_BILL_AMT3,</span>
<span id="cb5-972"><a href="#cb5-972" aria-hidden="true" tabindex="-1"></a>  <span class="at">BILL_AMT4 =</span> amt_means<span class="sc">$</span>mean_BILL_AMT4,</span>
<span id="cb5-973"><a href="#cb5-973" aria-hidden="true" tabindex="-1"></a>  <span class="at">BILL_AMT5 =</span> amt_means<span class="sc">$</span>mean_BILL_AMT5,</span>
<span id="cb5-974"><a href="#cb5-974" aria-hidden="true" tabindex="-1"></a>  <span class="at">BILL_AMT6 =</span> amt_means<span class="sc">$</span>mean_BILL_AMT6,</span>
<span id="cb5-975"><a href="#cb5-975" aria-hidden="true" tabindex="-1"></a>  <span class="at">PAY_AMT1  =</span> amt_means<span class="sc">$</span>mean_PAY_AMT1,</span>
<span id="cb5-976"><a href="#cb5-976" aria-hidden="true" tabindex="-1"></a>  <span class="at">PAY_AMT2  =</span> amt_means<span class="sc">$</span>mean_PAY_AMT2,</span>
<span id="cb5-977"><a href="#cb5-977" aria-hidden="true" tabindex="-1"></a>  <span class="at">PAY_AMT3  =</span> amt_means<span class="sc">$</span>mean_PAY_AMT3,</span>
<span id="cb5-978"><a href="#cb5-978" aria-hidden="true" tabindex="-1"></a>  <span class="at">PAY_AMT4  =</span> amt_means<span class="sc">$</span>mean_PAY_AMT4,</span>
<span id="cb5-979"><a href="#cb5-979" aria-hidden="true" tabindex="-1"></a>  <span class="at">PAY_AMT5  =</span> amt_means<span class="sc">$</span>mean_PAY_AMT5,</span>
<span id="cb5-980"><a href="#cb5-980" aria-hidden="true" tabindex="-1"></a>  <span class="at">PAY_AMT6  =</span> amt_means<span class="sc">$</span>mean_PAY_AMT6</span>
<span id="cb5-981"><a href="#cb5-981" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-982"><a href="#cb5-982" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-983"><a href="#cb5-983" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Predict the default probability</span></span>
<span id="cb5-984"><a href="#cb5-984" aria-hidden="true" tabindex="-1"></a>pred_probs <span class="ot">&lt;-</span> <span class="fu">predict</span>(logit_model,</span>
<span id="cb5-985"><a href="#cb5-985" aria-hidden="true" tabindex="-1"></a>                      <span class="at">newdata =</span> new_customer,</span>
<span id="cb5-986"><a href="#cb5-986" aria-hidden="true" tabindex="-1"></a>                      <span class="at">type   =</span> <span class="st">"prob"</span>)</span>
<span id="cb5-987"><a href="#cb5-987" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-988"><a href="#cb5-988" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract probability of default = “Yes”</span></span>
<span id="cb5-989"><a href="#cb5-989" aria-hidden="true" tabindex="-1"></a>pred_prob <span class="ot">&lt;-</span> pred_probs[ , <span class="st">"Yes"</span>]</span>
<span id="cb5-990"><a href="#cb5-990" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-991"><a href="#cb5-991" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Decide approval with threshold = 0.5</span></span>
<span id="cb5-992"><a href="#cb5-992" aria-hidden="true" tabindex="-1"></a>decision <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(pred_prob <span class="sc">&lt;</span> <span class="fl">0.5</span>, <span class="st">"Approve"</span>, <span class="st">"Reject"</span>)</span>
<span id="cb5-993"><a href="#cb5-993" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-994"><a href="#cb5-994" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Credit line decision for this customer:"</span>, decision, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>